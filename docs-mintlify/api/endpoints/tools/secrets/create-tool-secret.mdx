---
title: "Create Tool Secret"
api: "POST /tools/{toolId}/secrets"
description: "Store secure credentials for a tool integration"
---

## Overview

The Create Tool Secret endpoint allows you to securely store authentication credentials (API keys, OAuth tokens, etc.) for tool integrations. All credentials are encrypted and stored securely within your organization's isolated storage.

## Authentication

<ParamField header="x-org-id" type="string" required>
  Organization ID for multi-tenant access control
</ParamField>

<ParamField header="x-user-id" type="string" required>
  User ID of the requesting user for authorization
</ParamField>

<ParamField header="authorization" type="string" required>
  Bearer token for API authentication
</ParamField>

## Path Parameters

<ParamField path="toolId" type="string" required>
  The unique identifier of the tool to store credentials for
</ParamField>

## Request Body

### API Key Credentials

<ParamField body="type" type="string" required>
  Must be "api_key"
</ParamField>

<ParamField body="credentials" type="object" required>
  API key credentials to store
  
  <Expandable title="API Key Credentials">
    <ParamField body="apiKey" type="string" required>
      The API key value to store securely
    </ParamField>
    
    <ParamField body="keyName" type="string">
      Display name for this API key (optional)
    </ParamField>
    
    <ParamField body="environment" type="string">
      Environment this key is for: "production", "staging", "development"
    </ParamField>
    
    <ParamField body="expiresAt" type="string">
      ISO timestamp when this API key expires (optional)
    </ParamField>
  </Expandable>
</ParamField>

### OAuth2 Token Credentials

<ParamField body="type" type="string" required>
  Must be "oauth2"
</ParamField>

<ParamField body="credentials" type="object" required>
  OAuth2 token credentials to store
  
  <Expandable title="OAuth2 Credentials">
    <ParamField body="accessToken" type="string" required>
      The OAuth2 access token
    </ParamField>
    
    <ParamField body="refreshToken" type="string">
      The OAuth2 refresh token (if available)
    </ParamField>
    
    <ParamField body="tokenType" type="string">
      Token type (usually "Bearer")
    </ParamField>
    
    <ParamField body="scopes" type="array">
      Array of granted OAuth scopes
    </ParamField>
    
    <ParamField body="expiresAt" type="string">
      ISO timestamp when the access token expires
    </ParamField>
    
    <ParamField body="expiresIn" type="number">
      Seconds until token expiration (alternative to expiresAt)
    </ParamField>
  </Expandable>
</ParamField>

### Custom Credentials

<ParamField body="type" type="string" required>
  Must be "custom"
</ParamField>

<ParamField body="credentials" type="object" required>
  Custom credential fields as key-value pairs
  
  <Expandable title="Custom Credentials">
    <ParamField body="[fieldName]" type="string">
      Any custom field name with its corresponding value
    </ParamField>
  </Expandable>
</ParamField>

## Optional Fields

<ParamField body="name" type="string">
  Human-readable name for these credentials
</ParamField>

<ParamField body="description" type="string">
  Description of what these credentials are used for
</ParamField>

<ParamField body="tags" type="array">
  Array of tags for organizing credentials
</ParamField>

<ParamField body="autoRefresh" type="boolean">
  Whether to automatically refresh OAuth tokens (defaults to true for OAuth2)
</ParamField>

## Response

**Status Code:** `201 Created`

<ResponseField name="id" type="string">
  Unique identifier for the stored credentials
</ResponseField>

<ResponseField name="toolId" type="string">
  The tool ID these credentials are associated with
</ResponseField>

<ResponseField name="type" type="string">
  Credential type: "api_key", "oauth2", or "custom"
</ResponseField>

<ResponseField name="name" type="string">
  Human-readable name for the credentials
</ResponseField>

<ResponseField name="status" type="string">
  Credential status: "active", "expired", "error", or "revoked"
</ResponseField>

<ResponseField name="maskedCredentials" type="object">
  Credentials with sensitive values masked for security
  
  <Expandable title="Masked Credentials Example">
    <ResponseField name="apiKey" type="string">
      "sk_test_****...****abc123" (API key with middle characters masked)
    </ResponseField>
    
    <ResponseField name="accessToken" type="string">
      "ya29.****...****xyz789" (Token with middle characters masked)
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="expiresAt" type="string">
  ISO timestamp when credentials expire (if applicable)
</ResponseField>

<ResponseField name="createdAt" type="string">
  ISO timestamp when credentials were stored
</ResponseField>

<ResponseField name="createdBy" type="string">
  User ID who stored these credentials
</ResponseField>

<ResponseField name="lastUsedAt" type="string">
  ISO timestamp when credentials were last used (null if never used)
</ResponseField>

<ResponseField name="autoRefresh" type="boolean">
  Whether automatic token refresh is enabled
</ResponseField>

## Error Responses

<ResponseField name="400" type="object">
  Bad Request - Invalid credentials or missing required fields
  
  <Expandable title="Error Schema">
    <ResponseField name="error" type="string">
      Error type identifier
    </ResponseField>
    <ResponseField name="message" type="string">
      Human-readable error description
    </ResponseField>
    <ResponseField name="details" type="object">
      Field-specific validation errors
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="409" type="object">
  Conflict - Credentials already exist for this tool
  
  <Expandable title="Conflict Resolution">
    <ResponseField name="error" type="string">
      "CREDENTIALS_ALREADY_EXIST"
    </ResponseField>
    <ResponseField name="existingCredentialId" type="string">
      ID of the existing credentials
    </ResponseField>
    <ResponseField name="message" type="string">
      Guidance on how to update existing credentials
    </ResponseField>
  </Expandable>
</ResponseField>

## Usage Examples

<CodeGroup>

```bash cURL API Key
curl -X POST "https://api.tolstoy.com/v1/tools/github-tool-123/secrets" \
  -H "Authorization: Bearer $API_TOKEN" \
  -H "X-Org-ID: org_123456" \
  -H "X-User-ID: user_789012" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "api_key",
    "name": "GitHub Personal Access Token",
    "credentials": {
      "apiKey": "ghp_1234567890abcdef1234567890abcdef12345678",
      "environment": "production"
    },
    "tags": ["github", "production"],
    "description": "Token for accessing GitHub API"
  }'
```

```bash cURL OAuth2
curl -X POST "https://api.tolstoy.com/v1/tools/slack-tool-456/secrets" \
  -H "Authorization: Bearer $API_TOKEN" \
  -H "X-Org-ID: org_123456" \
  -H "X-User-ID: user_789012" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "oauth2",
    "name": "Slack Workspace Integration",
    "credentials": {
      "accessToken": "xoxp-1234-5678-90123-abcdef",
      "refreshToken": "xoxe-1-abcd-efgh-ijkl",
      "tokenType": "Bearer",
      "scopes": ["chat:write", "channels:read"],
      "expiresIn": 3600
    },
    "autoRefresh": true
  }'
```

```javascript JavaScript
// Store API key credentials
const apiKeyResponse = await fetch('/api/v1/tools/github-tool-123/secrets', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${apiToken}`,
    'X-Org-ID': 'org_123456',
    'X-User-ID': 'user_789012',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    type: 'api_key',
    name: 'GitHub Personal Access Token',
    credentials: {
      apiKey: 'ghp_1234567890abcdef1234567890abcdef12345678',
      environment: 'production'
    },
    tags: ['github', 'production'],
    description: 'Token for accessing GitHub API'
  })
});

// Store OAuth2 credentials
const oauthResponse = await fetch('/api/v1/tools/slack-tool-456/secrets', {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${apiToken}`,
    'X-Org-ID': 'org_123456',
    'X-User-ID': 'user_789012',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    type: 'oauth2',
    name: 'Slack Workspace Integration',
    credentials: {
      accessToken: 'xoxp-1234-5678-90123-abcdef',
      refreshToken: 'xoxe-1-abcd-efgh-ijkl',
      tokenType: 'Bearer',
      scopes: ['chat:write', 'channels:read'],
      expiresIn: 3600
    },
    autoRefresh: true
  })
});
```

```python Python
import requests
from datetime import datetime, timedelta

# Store API key credentials
api_key_response = requests.post(
    "https://api.tolstoy.com/v1/tools/github-tool-123/secrets",
    headers={
        "Authorization": f"Bearer {api_token}",
        "X-Org-ID": "org_123456",
        "X-User-ID": "user_789012",
        "Content-Type": "application/json"
    },
    json={
        "type": "api_key",
        "name": "GitHub Personal Access Token",
        "credentials": {
            "apiKey": "ghp_1234567890abcdef1234567890abcdef12345678",
            "environment": "production"
        },
        "tags": ["github", "production"],
        "description": "Token for accessing GitHub API"
    }
)

# Store OAuth2 credentials with expiration
expires_at = (datetime.utcnow() + timedelta(hours=1)).isoformat() + 'Z'
oauth_response = requests.post(
    "https://api.tolstoy.com/v1/tools/slack-tool-456/secrets",
    headers={
        "Authorization": f"Bearer {api_token}",
        "X-Org-ID": "org_123456",
        "X-User-ID": "user_789012",
        "Content-Type": "application/json"
    },
    json={
        "type": "oauth2",
        "name": "Slack Workspace Integration",
        "credentials": {
            "accessToken": "xoxp-1234-5678-90123-abcdef",
            "refreshToken": "xoxe-1-abcd-efgh-ijkl",
            "tokenType": "Bearer",
            "scopes": ["chat:write", "channels:read"],
            "expiresAt": expires_at
        },
        "autoRefresh": True
    }
)
```

</CodeGroup>

## Security Features

### Encryption
- All credentials are encrypted using AES-256 encryption before storage
- Encryption keys are managed securely and rotated regularly
- No plaintext credentials are ever stored or logged

### Access Control
- Credentials are scoped to organizations and cannot cross tenant boundaries
- Role-based access controls determine who can store and access credentials
- All access attempts are logged for audit purposes

### Masking
- Sensitive credential values are automatically masked in API responses
- Only the first and last few characters are shown for verification
- Original values are never returned in API responses after storage

### Automatic Refresh
- OAuth2 tokens are automatically refreshed before expiration
- Refresh failures trigger notifications and webhook events
- Manual refresh can be triggered via the API

## Webhook Events

The following webhook events are triggered:

- `tool.credentials_stored` - When new credentials are successfully stored
- `tool.credentials_expired` - When stored credentials expire
- `tool.credentials_refreshed` - When OAuth2 tokens are automatically refreshed
- `tool.credentials_refresh_failed` - When automatic token refresh fails

## Related Endpoints

- [List Tool Secrets](/api/endpoints/tools/secrets/list-tool-secrets) - List stored credentials
- [Get Tool Secret](/api/endpoints/tools/secrets/get-tool-secret) - Retrieve specific credentials
- [Update Tool Secret](/api/endpoints/tools/secrets/update-tool-secret) - Update stored credentials
- [Delete Tool Secret](/api/endpoints/tools/secrets/delete-tool-secret) - Remove credentials