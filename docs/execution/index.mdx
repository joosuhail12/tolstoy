---
title: Execution & Monitoring
sidebar_position: 7
---

# Execution & Monitoring

Monitor and manage workflow executions with Tolstoy's comprehensive execution tracking, real-time monitoring, and performance analytics.

## Execution Overview

Tolstoy provides two execution modes with full monitoring capabilities:

### Execution Modes

| Mode | Description | Use Cases | Monitoring |
|------|-------------|-----------|------------|
| **Synchronous** | Immediate execution with real-time response | Quick workflows, API integrations | Real-time logs |  
| **Asynchronous** | Durable execution via Inngest queues | Long-running workflows, batch jobs | Event-driven updates |

## Starting Executions

### Synchronous Execution
Perfect for workflows that complete quickly (under 30 seconds):

```bash
curl -X POST https://api.tolstoy.dev/flows/flow_abc123/execute \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id" \
  -H "Content-Type: application/json" \
  -d '{
    "mode": "sync",
    "inputs": {
      "userId": "user_123",
      "email": "user@example.com"
    }
  }'
```

Response:
```json
{
  "executionId": "exec_abc123",
  "status": "completed",
  "startedAt": "2024-01-15T10:30:00Z",
  "completedAt": "2024-01-15T10:30:15Z",
  "duration": 15000,
  "steps": [
    {
      "key": "validate-user",
      "status": "completed", 
      "startedAt": "2024-01-15T10:30:00Z",
      "completedAt": "2024-01-15T10:30:05Z",
      "outputs": {
        "isValid": true,
        "userId": "user_123"
      }
    }
  ]
}
```

### Asynchronous Execution  
Ideal for complex workflows that may take minutes or hours:

```bash
curl -X POST https://api.tolstoy.dev/flows/flow_abc123/execute \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id" \
  -H "Content-Type: application/json" \
  -d '{
    "mode": "async",
    "inputs": {
      "batchSize": 1000,
      "dataSource": "s3://bucket/data.csv"
    },
    "retryPolicy": {
      "maxRetries": 3,
      "backoffStrategy": "exponential"
    }
  }'
```

Response:
```json
{
  "executionId": "exec_abc123",
  "status": "running",
  "startedAt": "2024-01-15T10:30:00Z",
  "estimatedDuration": 1800000
}
```

## Execution Monitoring

### Real-time Status
Track execution progress in real-time:

```bash
curl https://api.tolstoy.dev/flows/flow_abc123/executions/exec_abc123 \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id"
```

Response:
```json
{
  "id": "exec_abc123",
  "flowId": "flow_abc123", 
  "status": "running",
  "startedAt": "2024-01-15T10:30:00Z",
  "currentStep": "process-batch-2",
  "progress": {
    "totalSteps": 5,
    "completedSteps": 2,
    "percentage": 40
  },
  "metrics": {
    "duration": 120000,
    "stepsExecuted": 2,
    "stepsSuccessful": 2,
    "stepsFailed": 0,
    "stepsSkipped": 0
  }
}
```

### Execution States

| Status | Description | Next Actions |
|--------|-------------|--------------|
| `pending` | Queued for execution | Wait or cancel |
| `running` | Currently executing | Monitor progress |
| `completed` | Finished successfully | View results |
| `failed` | Encountered fatal error | Review logs, retry |
| `cancelled` | Manually stopped | Restart if needed |
| `timeout` | Exceeded time limit | Increase timeout, retry |

## Step-Level Monitoring

### Execution Logs
View detailed step-by-step execution logs:

```bash
curl https://api.tolstoy.dev/execution-logs?executionId=exec_abc123 \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id"
```

Response:
```json
{
  "logs": [
    {
      "id": "log_abc123",
      "executionId": "exec_abc123",
      "stepKey": "validate-user",
      "status": "completed",
      "startedAt": "2024-01-15T10:30:00Z",
      "completedAt": "2024-01-15T10:30:05Z",
      "duration": 5000,
      "inputs": {
        "userId": "user_123",
        "email": "user@example.com"
      },
      "outputs": {
        "isValid": true,
        "validationDetails": {
          "emailFormat": true,
          "userExists": true
        }
      },
      "metrics": {
        "apiCalls": 2,
        "responseTime": 250,
        "memoryUsage": 15.2
      }
    }
  ]
}
```

### Step Status Details

Each step provides comprehensive execution information:

```json
{
  "stepKey": "send-notification",
  "action": "slack.send-message", 
  "status": "failed",
  "startedAt": "2024-01-15T10:30:10Z",
  "failedAt": "2024-01-15T10:30:12Z",
  "duration": 2000,
  "attempts": 2,
  "error": {
    "code": "RATE_LIMITED",
    "message": "Slack API rate limit exceeded",
    "details": {
      "retryAfter": 60,
      "rateLimitRemaining": 0
    }
  },
  "retrySchedule": {
    "nextAttempt": "2024-01-15T10:31:12Z",
    "maxRetries": 3,
    "currentAttempt": 2
  }
}
```

## Execution Management

### Cancel Running Execution
```bash
curl -X POST https://api.tolstoy.dev/flows/flow_abc123/executions/exec_abc123/cancel \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id"
```

### Retry Failed Execution
```bash
curl -X POST https://api.tolstoy.dev/flows/flow_abc123/executions/exec_abc123/retry \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id" \
  -H "Content-Type: application/json" \
  -d '{
    "fromStep": "failed-step-key",
    "retryPolicy": {
      "maxRetries": 5,
      "backoffStrategy": "linear"
    }
  }'
```

### List Executions
```bash
# All executions for a flow
curl https://api.tolstoy.dev/flows/flow_abc123/executions \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id"

# Filter by status
curl "https://api.tolstoy.dev/flows/flow_abc123/executions?status=failed" \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id"

# Recent executions across all flows
curl "https://api.tolstoy.dev/executions?limit=50&sort=startedAt:desc" \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id"
```

## Performance Metrics

### Flow-Level Metrics
Get comprehensive performance analytics:

```bash
curl https://api.tolstoy.dev/flows/flow_abc123/metrics \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id" \
  -H "Content-Type: application/json" \
  -d '{
    "timeRange": {
      "start": "2024-01-01T00:00:00Z",
      "end": "2024-01-31T23:59:59Z"
    },
    "granularity": "day"
  }'
```

Response:
```json
{
  "summary": {
    "totalExecutions": 1250,
    "successfulExecutions": 1180,
    "failedExecutions": 70,
    "successRate": 94.4,
    "averageDuration": 45000,
    "p95Duration": 120000,
    "p99Duration": 300000
  },
  "timeline": [
    {
      "date": "2024-01-15",
      "executions": 42,
      "successful": 40,
      "failed": 2,
      "averageDuration": 38000
    }
  ],
  "stepMetrics": [
    {
      "stepKey": "api-call", 
      "averageDuration": 1200,
      "successRate": 98.5,
      "errorRate": 1.5,
      "mostCommonErrors": [
        "TIMEOUT",
        "RATE_LIMITED"
      ]
    }
  ]
}
```

### Execution Analytics Dashboard

Key metrics tracked automatically:

| Metric | Description | Use Case |
|--------|-------------|----------|
| **Success Rate** | % of executions completing successfully | Reliability monitoring |
| **Duration Percentiles** | P50, P95, P99 execution times | Performance optimization |
| **Error Rates** | Failure rates by error type | Troubleshooting |
| **Throughput** | Executions per time period | Capacity planning |
| **Step Performance** | Individual step success/duration | Bottleneck identification |

## Real-time Updates

### WebSocket Connection
Connect to real-time execution updates:

```javascript
// Using Ably WebSocket connection
const ably = new Ably.Realtime({
  key: 'your-ably-key',
  clientId: 'your-user-id'
});

const channel = ably.channels.get(`executions:${orgId}`);

// Subscribe to execution updates
channel.subscribe('execution.started', (message) => {
  console.log('Execution started:', message.data);
});

channel.subscribe('execution.step.completed', (message) => {
  console.log('Step completed:', message.data);
});

channel.subscribe('execution.completed', (message) => {
  console.log('Execution finished:', message.data);
});
```

### Webhook Integration
Set up webhooks for execution events:

```bash
curl -X POST https://api.tolstoy.dev/webhooks \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id" \
  -H "Content-Type: application/json" \
  -d '{
    "url": "https://your-app.com/webhooks/executions",
    "eventTypes": [
      "execution.started",
      "execution.completed", 
      "execution.failed",
      "execution.step.failed"
    ]
  }'
```

## Error Handling & Debugging

### Error Analysis
Analyze execution failures:

```bash
curl https://api.tolstoy.dev/flows/flow_abc123/executions/exec_abc123/errors \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id"
```

Response:
```json
{
  "errors": [
    {
      "stepKey": "api-integration",
      "errorCode": "HTTP_502",
      "errorMessage": "Bad Gateway - upstream service unavailable",
      "timestamp": "2024-01-15T10:30:15Z",
      "context": {
        "url": "https://api.external.com/v1/users",
        "method": "POST",
        "statusCode": 502,
        "responseBody": "Service temporarily unavailable"
      },
      "suggestions": [
        "Implement retry with exponential backoff",
        "Check external service status",
        "Consider circuit breaker pattern"
      ]
    }
  ]
}
```

### Debug Mode Execution
Run executions with enhanced debugging:

```bash
curl -X POST https://api.tolstoy.dev/flows/flow_abc123/execute \
  -H "x-org-id: your-org-id" \
  -H "x-user-id: your-user-id" \
  -H "Content-Type: application/json" \
  -d '{
    "mode": "sync",
    "debug": true,
    "inputs": {
      "testMode": true
    }
  }'
```

Debug mode provides:
- Detailed request/response logs
- Variable interpolation traces  
- Condition evaluation results
- Performance timing breakdown

## Execution Patterns

### Batch Processing
Handle large datasets efficiently:

```json
{
  "name": "Process User Batch",
  "steps": [
    {
      "key": "split-batch",
      "action": "data.chunk",
      "inputs": {
        "data": "{{context.users}}",
        "chunkSize": 100
      }
    },
    {
      "key": "process-chunk",
      "action": "control.for_each", 
      "inputs": {
        "items": "{{steps.split-batch.output.chunks}}",
        "parallelism": 5,
        "steps": [
          {
            "key": "process-user",
            "action": "crm.update-user"
          }
        ]
      }
    }
  ]
}
```

### Conditional Execution
Dynamic workflow paths based on data:

```json
{
  "steps": [
    {
      "key": "check-user-type",
      "action": "data.evaluate",
      "inputs": {
        "expression": "user.accountType"
      }
    },
    {
      "key": "premium-workflow",
      "action": "premium.process",
      "executeIf": {
        "operator": "equals",
        "field": "steps.check-user-type.output.value",
        "value": "premium"
      }
    },
    {
      "key": "standard-workflow", 
      "action": "standard.process",
      "executeIf": {
        "operator": "equals",
        "field": "steps.check-user-type.output.value", 
        "value": "standard"
      }
    }
  ]
}
```

## Monitoring Best Practices

### Performance Optimization
- Monitor P95/P99 execution times
- Set up alerts for degraded performance
- Identify and optimize slow steps
- Use async mode for long-running workflows

### Error Management
- Implement appropriate retry policies
- Monitor error rates and patterns
- Set up alerting for critical failures
- Use circuit breakers for external services

### Capacity Planning
- Track execution volume trends
- Monitor resource utilization
- Plan for peak usage periods
- Scale based on execution metrics

### Observability
- Use structured logging with context
- Implement distributed tracing
- Monitor business metrics alongside technical metrics
- Create meaningful dashboards and alerts

## Integration with Monitoring Tools

### Prometheus Metrics
Tolstoy exposes metrics in Prometheus format:

```
# Execution metrics
tolstoy_executions_total{status="completed"} 1250
tolstoy_executions_total{status="failed"} 70
tolstoy_execution_duration_seconds{quantile="0.5"} 0.045
tolstoy_execution_duration_seconds{quantile="0.95"} 0.12

# Step metrics  
tolstoy_step_executions_total{step_key="api-call",status="completed"} 1180
tolstoy_step_duration_seconds{step_key="api-call",quantile="0.95"} 0.002
```

### Custom Monitoring Integration
Send execution data to your monitoring systems:

```javascript
// Custom monitoring webhook handler
app.post('/webhook/execution-monitoring', (req, res) => {
  const event = req.body;
  
  if (event.eventType === 'execution.completed') {
    // Send metrics to DataDog/NewRelic/etc
    monitoring.gauge('execution.duration', event.data.duration, {
      flowId: event.data.flowId,
      status: event.data.status
    });
    
    monitoring.increment('execution.count', {
      flowId: event.data.flowId,
      status: event.data.status
    });
  }
  
  res.status(200).send('OK');
});
```

## Next Steps

- **[Webhooks Guide](/webhooks)** - Set up real-time execution notifications
- **[Flow Definition Guide](/flow-definition)** - Optimize your workflows for better execution
- **[API Reference](/api)** - Complete execution API documentation
- **[Security Guide](/security)** - Secure execution monitoring and access control