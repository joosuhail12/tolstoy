---
title: "Authentication"
description: "Secure authentication methods for the Tolstoy API"
---

# Authentication

The Tolstoy API uses API key-based authentication to secure all endpoints. All requests must include a valid API key in the Authorization header.

## API Key Authentication

All API requests must include your API key in the `Authorization` header using the Bearer token format.

### **Request Format**

```bash
curl -X GET 'https://api.tolstoy.dev/organizations' \
  -H 'Authorization: Bearer YOUR_API_KEY' \
  -H 'Content-Type: application/json'
```

### **Header Structure**

| Header | Value | Required |
|--------|-------|----------|
| `Authorization` | `Bearer YOUR_API_KEY` | ‚úÖ Yes |
| `Content-Type` | `application/json` | ‚úÖ Yes |

## Obtaining API Keys

API keys are tied to organizations and provide access to all resources within that organization's scope.

### **Creating an API Key**

<CodeGroup>

```bash cURL
curl -X POST 'https://api.tolstoy.dev/organizations/{orgId}/api-keys' \
  -H 'Authorization: Bearer ADMIN_API_KEY' \
  -H 'Content-Type: application/json' \
  -d '{
    "name": "Production API Key",
    "permissions": ["read", "write", "execute"],
    "expiresAt": "2025-12-31T23:59:59Z"
  }'
```

```javascript JavaScript
const response = await fetch('https://api.tolstoy.dev/organizations/{orgId}/api-keys', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ADMIN_API_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    name: 'Production API Key',
    permissions: ['read', 'write', 'execute'],
    expiresAt: '2025-12-31T23:59:59Z'
  })
});

const apiKey = await response.json();
console.log('API Key:', apiKey.key);
```

```python Python
import requests

response = requests.post(
    'https://api.tolstoy.dev/organizations/{orgId}/api-keys',
    headers={
        'Authorization': 'Bearer ADMIN_API_KEY',
        'Content-Type': 'application/json'
    },
    json={
        'name': 'Production API Key',
        'permissions': ['read', 'write', 'execute'],
        'expiresAt': '2025-12-31T23:59:59Z'
    }
)

api_key = response.json()
print(f"API Key: {api_key['key']}")
```

</CodeGroup>

## API Key Permissions

API keys can be configured with specific permissions to limit access:

| Permission | Description | Endpoints |
|------------|-------------|-----------|
| `read` | View resources | GET endpoints |
| `write` | Create and update resources | POST, PUT, PATCH endpoints |
| `delete` | Remove resources | DELETE endpoints |
| `execute` | Execute actions and flows | Execute endpoints |
| `admin` | Full administrative access | All endpoints |

### **Permission Examples**

<Tabs>
  <Tab title="Read-Only Key">
    ```json
    {
      "name": "Analytics Dashboard",
      "permissions": ["read"],
      "expiresAt": "2025-12-31T23:59:59Z"
    }
    ```
    
    Can access:
    - GET /organizations
    - GET /flows
    - GET /execution-logs
    
    Cannot access:
    - POST /flows
    - DELETE /actions
    - POST /flows/{id}/execute
  </Tab>
  
  <Tab title="Execution Key">
    ```json
    {
      "name": "Workflow Executor",
      "permissions": ["read", "execute"],
      "expiresAt": "2025-12-31T23:59:59Z"
    }
    ```
    
    Can access:
    - GET endpoints (view resources)
    - POST /flows/{id}/execute
    - POST /actions/{key}/execute
    
    Cannot access:
    - POST /flows (create flows)
    - DELETE endpoints
  </Tab>
  
  <Tab title="Full Access Key">
    ```json
    {
      "name": "Development Environment",
      "permissions": ["read", "write", "delete", "execute"],
      "expiresAt": "2025-12-31T23:59:59Z"
    }
    ```
    
    Can access all endpoints within the organization.
  </Tab>
</Tabs>

## Security Best Practices

### **Key Management**

<Warning>
**Keep your API keys secure!** Treat API keys like passwords and never expose them in client-side code or public repositories.
</Warning>

**‚úÖ Best Practices:**
- Store API keys in environment variables
- Use different keys for different environments
- Rotate keys regularly (every 90 days recommended)
- Use minimum required permissions
- Monitor API key usage

**‚ùå Never do this:**
- Hardcode keys in source code
- Share keys in chat or email
- Use the same key across environments
- Leave unused keys active

### **Key Rotation**

<CodeGroup>

```bash Key Rotation Script
#!/bin/bash
# Rotate API key safely

# 1. Create new key
NEW_KEY=$(curl -s -X POST 'https://api.tolstoy.dev/organizations/{orgId}/api-keys' \
  -H "Authorization: Bearer $CURRENT_API_KEY" \
  -H 'Content-Type: application/json' \
  -d '{"name": "Rotated Production Key", "permissions": ["read", "write", "execute"]}' \
  | jq -r '.key')

# 2. Update environment variables
export TOLSTOY_API_KEY=$NEW_KEY

# 3. Test new key
curl -s -X GET 'https://api.tolstoy.dev/organizations' \
  -H "Authorization: Bearer $NEW_KEY" > /dev/null

if [ $? -eq 0 ]; then
  echo "‚úÖ New key is working"
  
  # 4. Revoke old key
  curl -X DELETE "https://api.tolstoy.dev/api-keys/$OLD_KEY_ID" \
    -H "Authorization: Bearer $NEW_KEY"
    
  echo "üîÑ Key rotation complete"
else
  echo "‚ùå New key failed, keeping old key"
fi
```

```javascript Node.js
// Automated key rotation
async function rotateApiKey() {
  const currentKey = process.env.TOLSTOY_API_KEY;
  
  // Create new key
  const response = await fetch(`https://api.tolstoy.dev/organizations/${orgId}/api-keys`, {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${currentKey}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      name: `Rotated Key ${new Date().toISOString()}`,
      permissions: ['read', 'write', 'execute'],
      expiresAt: new Date(Date.now() + 90 * 24 * 60 * 60 * 1000).toISOString() // 90 days
    })
  });
  
  const newKey = await response.json();
  
  // Test new key
  const testResponse = await fetch('https://api.tolstoy.dev/organizations', {
    headers: { 'Authorization': `Bearer ${newKey.key}` }
  });
  
  if (testResponse.ok) {
    console.log('‚úÖ New key working, updating environment...');
    process.env.TOLSTOY_API_KEY = newKey.key;
    
    // TODO: Update your deployment environment variables
    // TODO: Revoke old key after confirming everything works
  } else {
    throw new Error('‚ùå New key validation failed');
  }
}
```

</CodeGroup>

## Authentication Errors

### **Common Error Responses**

<CodeGroup>

```json 401 Unauthorized
{
  "error": {
    "code": "UNAUTHORIZED",
    "message": "Invalid or missing API key",
    "details": "The provided API key is invalid, expired, or missing from the Authorization header."
  }
}
```

```json 403 Forbidden
{
  "error": {
    "code": "FORBIDDEN", 
    "message": "Insufficient permissions",
    "details": "Your API key does not have the required permissions to access this resource.",
    "required_permission": "write"
  }
}
```

```json 429 Rate Limited
{
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Too many requests",
    "details": "Rate limit exceeded for this API key.",
    "retry_after": 60,
    "limit": 1000,
    "window": "1h"
  }
}
```

</CodeGroup>

### **Error Troubleshooting**

<AccordionGroup>
  <Accordion title="401 - Invalid API Key">
    **Possible causes:**
    - API key is incorrect or malformed
    - API key has been revoked or expired
    - Missing `Bearer` prefix in Authorization header
    
    **Solutions:**
    - Verify the API key format: `Bearer your-api-key-here`
    - Check if the key has expired
    - Generate a new API key if needed
  </Accordion>
  
  <Accordion title="403 - Insufficient Permissions">
    **Possible causes:**
    - API key doesn't have required permissions
    - Trying to access resources outside organization scope
    
    **Solutions:**
    - Check the required permission in the error response
    - Update API key permissions
    - Use a key with higher privileges
  </Accordion>
  
  <Accordion title="429 - Rate Limited">
    **Possible causes:**
    - Too many requests in short time period
    - API key hitting organization rate limits
    
    **Solutions:**
    - Wait for the `retry_after` duration
    - Implement exponential backoff
    - Contact support for higher rate limits
  </Accordion>
</AccordionGroup>

## Organization Context

All API requests are automatically scoped to the organization associated with your API key. You don't need to specify the organization ID in most requests.

### **Multi-Organization Access**

If you need to access multiple organizations, you'll need separate API keys for each organization:

```javascript
// Different keys for different organizations
const prodClient = new TolstoyClient({
  apiKey: process.env.TOLSTOY_PROD_API_KEY,  // org_prod_123
  baseURL: 'https://api.tolstoy.dev'
});

const devClient = new TolstoyClient({
  apiKey: process.env.TOLSTOY_DEV_API_KEY,   // org_dev_456  
  baseURL: 'https://api.tolstoy.dev'
});

// Each client automatically operates in its organization context
const prodFlows = await prodClient.flows.list();
const devFlows = await devClient.flows.list();
```

## Testing Authentication

### **Quick Authentication Test**

<CodeGroup>

```bash Test with cURL
# Test your API key
curl -X GET 'https://api.tolstoy.dev/organizations' \
  -H 'Authorization: Bearer YOUR_API_KEY' \
  -H 'Content-Type: application/json'

# Expected response (200 OK)
[
  {
    "id": "org_123456789",
    "name": "Your Organization",
    "created_at": "2024-01-01T00:00:00Z"
  }
]
```

```javascript Test with JavaScript
// Test API key validity
async function testApiKey(apiKey) {
  try {
    const response = await fetch('https://api.tolstoy.dev/organizations', {
      headers: {
        'Authorization': `Bearer ${apiKey}`,
        'Content-Type': 'application/json'
      }
    });
    
    if (response.ok) {
      const orgs = await response.json();
      console.log('‚úÖ API key valid, organization:', orgs[0].name);
      return true;
    } else {
      console.log('‚ùå API key invalid:', response.status);
      return false;
    }
  } catch (error) {
    console.error('‚ùå Authentication test failed:', error.message);
    return false;
  }
}

// Usage
await testApiKey('your-api-key-here');
```

```python Test with Python
import requests

def test_api_key(api_key):
    """Test if API key is valid"""
    try:
        response = requests.get(
            'https://api.tolstoy.dev/organizations',
            headers={
                'Authorization': f'Bearer {api_key}',
                'Content-Type': 'application/json'
            }
        )
        
        if response.status_code == 200:
            orgs = response.json()
            print(f"‚úÖ API key valid, organization: {orgs[0]['name']}")
            return True
        else:
            print(f"‚ùå API key invalid: {response.status_code}")
            return False
            
    except Exception as error:
        print(f"‚ùå Authentication test failed: {error}")
        return False

# Usage
test_api_key('your-api-key-here')
```

</CodeGroup>

## Next Steps

<CardGroup cols={2}>
  <Card title="Rate Limiting" icon="gauge" href="/api/rate-limiting">
    Learn about API rate limits and best practices
  </Card>
  <Card title="Error Handling" icon="triangle-exclamation" href="/api/errors">
    Understand error codes and responses
  </Card>
  <Card title="Organizations API" icon="building" href="/api/organizations/list">
    Start with organization management
  </Card>
  <Card title="API Overview" icon="book" href="/api/overview">
    Return to API documentation overview
  </Card>
</CardGroup>