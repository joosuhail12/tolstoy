---
title: "Login"
description: "Authenticate with email and password to obtain access tokens"
---

# Login

<Badge variant="warning">POST</Badge> `/auth/login`

Authenticate using email and password credentials to obtain access and refresh tokens for API access.

## Request

### **HTTP Request**

```http
POST https://api.tolstoy.dev/auth/login
```

### **Request Body**

| Field | Type | Required | Description |
|-------|------|----------|-------------|
| `email` | string | Yes | User email address |
| `password` | string | Yes | User password |
| `mfa_code` | string | No | Multi-factor authentication code (if MFA enabled) |
| `remember_me` | boolean | No | Extend refresh token expiry (default: false) |

## Response

### **Success Response**

<CodeGroup>

```json 200 OK
{
  "auth": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "token_type": "Bearer",
    "expires_in": 3600,
    "refresh_expires_in": 2592000
  },
  "user": {
    "id": "user_123456789",
    "email": "john.doe@example.com",
    "name": "John Doe",
    "role": "admin",
    "organization_id": "org_987654321",
    "organization_name": "Acme Corporation",
    "permissions": [
      "actions:read",
      "actions:write",
      "flows:read",
      "flows:write",
      "users:read"
    ],
    "mfa_enabled": true,
    "last_login": "2024-01-14T10:30:00Z",
    "created_at": "2023-06-15T08:00:00Z"
  },
  "session": {
    "id": "sess_abc123xyz",
    "ip_address": "192.168.1.1",
    "user_agent": "Mozilla/5.0...",
    "created_at": "2024-01-15T20:00:00Z",
    "expires_at": "2024-01-15T21:00:00Z"
  }
}
```

</CodeGroup>

### **MFA Required Response**

<CodeGroup>

```json 202 Accepted
{
  "mfa_required": true,
  "mfa_token": "mfa_temp_token_abc123",
  "mfa_methods": ["totp", "sms"],
  "message": "Multi-factor authentication required"
}
```

</CodeGroup>

## Examples

### **Basic Login**

<CodeGroup>

```bash cURL
curl -X POST 'https://api.tolstoy.dev/auth/login' \
  -H 'Content-Type: application/json' \
  -d '{
    "email": "john.doe@example.com",
    "password": "SecurePassword123!"
  }'
```

```javascript JavaScript
const loginRequest = {
  email: "john.doe@example.com",
  password: "SecurePassword123!",
  remember_me: true
};

const response = await fetch('https://api.tolstoy.dev/auth/login', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  body: JSON.stringify(loginRequest)
});

if (response.ok) {
  const data = await response.json();
  
  // Store tokens securely
  localStorage.setItem('access_token', data.auth.access_token);
  localStorage.setItem('refresh_token', data.auth.refresh_token);
  
  console.log(`Logged in as: ${data.user.name}`);
  console.log(`Role: ${data.user.role}`);
  console.log(`Organization: ${data.user.organization_name}`);
  
  // Set authorization header for future requests
  axios.defaults.headers.common['Authorization'] = `Bearer ${data.auth.access_token}`;
}
```

```python Python
import requests
import json

login_data = {
    "email": "john.doe@example.com",
    "password": "SecurePassword123!"
}

response = requests.post(
    'https://api.tolstoy.dev/auth/login',
    headers={'Content-Type': 'application/json'},
    json=login_data
)

if response.status_code == 200:
    data = response.json()
    access_token = data['auth']['access_token']
    refresh_token = data['auth']['refresh_token']
    
    print(f"Logged in as: {data['user']['name']}")
    print(f"Access token expires in: {data['auth']['expires_in']} seconds")
    
    # Use token for authenticated requests
    headers = {'Authorization': f"Bearer {access_token}"}
```

</CodeGroup>

### **Login with MFA**

<CodeGroup>

```javascript MFA Flow
async function loginWithMFA(email, password, apiUrl) {
  // Step 1: Initial login
  const loginResponse = await fetch(`${apiUrl}/auth/login`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ email, password })
  });
  
  const loginData = await loginResponse.json();
  
  if (loginData.mfa_required) {
    // Step 2: Prompt for MFA code
    const mfaCode = await promptUserForMFACode();
    
    // Step 3: Complete login with MFA
    const mfaResponse = await fetch(`${apiUrl}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        email,
        password,
        mfa_code: mfaCode,
        mfa_token: loginData.mfa_token
      })
    });
    
    if (mfaResponse.ok) {
      const authData = await mfaResponse.json();
      return authData;
    } else {
      throw new Error('MFA verification failed');
    }
  }
  
  return loginData;
}

// Usage
try {
  const auth = await loginWithMFA(
    'john.doe@example.com',
    'SecurePassword123!',
    'https://api.tolstoy.dev'
  );
  
  console.log('Login successful:', auth.user.email);
  // Store tokens...
} catch (error) {
  console.error('Login failed:', error.message);
}
```

</CodeGroup>

### **Token Management**

<CodeGroup>

```javascript Token Storage & Refresh
class AuthManager {
  constructor(apiUrl) {
    this.apiUrl = apiUrl;
    this.accessToken = null;
    this.refreshToken = null;
    this.tokenExpiry = null;
  }
  
  async login(email, password) {
    const response = await fetch(`${this.apiUrl}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ email, password })
    });
    
    if (!response.ok) {
      throw new Error('Login failed');
    }
    
    const data = await response.json();
    this.storeTokens(data.auth);
    return data;
  }
  
  storeTokens(auth) {
    this.accessToken = auth.access_token;
    this.refreshToken = auth.refresh_token;
    this.tokenExpiry = Date.now() + (auth.expires_in * 1000);
    
    // Store in secure storage
    if (typeof window !== 'undefined') {
      sessionStorage.setItem('access_token', auth.access_token);
      localStorage.setItem('refresh_token', auth.refresh_token);
    }
  }
  
  isTokenExpired() {
    return !this.tokenExpiry || Date.now() >= this.tokenExpiry;
  }
  
  async getValidToken() {
    if (this.isTokenExpired()) {
      await this.refreshAccessToken();
    }
    return this.accessToken;
  }
  
  async refreshAccessToken() {
    const response = await fetch(`${this.apiUrl}/auth/refresh`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        refresh_token: this.refreshToken
      })
    });
    
    if (!response.ok) {
      throw new Error('Token refresh failed - please login again');
    }
    
    const data = await response.json();
    this.storeTokens(data.auth);
    return data.auth.access_token;
  }
  
  async makeAuthenticatedRequest(url, options = {}) {
    const token = await this.getValidToken();
    
    return fetch(url, {
      ...options,
      headers: {
        ...options.headers,
        'Authorization': `Bearer ${token}`
      }
    });
  }
}

// Usage
const auth = new AuthManager('https://api.tolstoy.dev');
await auth.login('john.doe@example.com', 'SecurePassword123!');

// Make authenticated requests
const response = await auth.makeAuthenticatedRequest(
  'https://api.tolstoy.dev/flows'
);
```

</CodeGroup>

## Error Responses

<CodeGroup>

```json 401 Unauthorized
{
  "error": {
    "code": "INVALID_CREDENTIALS",
    "message": "Invalid email or password",
    "type": "authentication",
    "timestamp": "2024-01-15T10:30:00Z",
    "request_id": "req_123456789"
  }
}
```

```json 403 Forbidden
{
  "error": {
    "code": "ACCOUNT_LOCKED",
    "message": "Account temporarily locked due to multiple failed login attempts",
    "type": "authentication",
    "details": {
      "locked_until": "2024-01-15T11:00:00Z",
      "attempts": 5
    },
    "timestamp": "2024-01-15T10:30:00Z",
    "request_id": "req_123456789"
  }
}
```

```json 422 Unprocessable Entity
{
  "error": {
    "code": "MFA_INVALID",
    "message": "Invalid or expired MFA code",
    "type": "authentication",
    "details": {
      "mfa_method": "totp"
    },
    "timestamp": "2024-01-15T10:30:00Z",
    "request_id": "req_123456789"
  }
}
```

```json 429 Rate Limited
{
  "error": {
    "code": "RATE_LIMIT_EXCEEDED",
    "message": "Too many login attempts",
    "type": "rate_limit",
    "details": {
      "retry_after": 300,
      "limit": 5,
      "window": "5 minutes"
    },
    "timestamp": "2024-01-15T10:30:00Z",
    "request_id": "req_123456789"
  }
}
```

</CodeGroup>

## Security Considerations

### **Password Requirements**

- Minimum 8 characters
- At least one uppercase letter
- At least one lowercase letter
- At least one number
- At least one special character

### **Token Security**

- Access tokens expire after 1 hour by default
- Refresh tokens expire after 30 days (90 days with remember_me)
- Tokens should be stored securely (never in local storage for sensitive apps)
- Always use HTTPS for token transmission

### **Rate Limiting**

- 5 login attempts per 5 minutes per IP
- 10 login attempts per hour per email
- Account lockout after 5 consecutive failed attempts

## API Playground

Try logging in:

<ApiPlayground
  method="POST"
  endpoint="/auth/login"
  baseUrl="https://api.tolstoy.dev"
  body={{
    type: "json",
    schema: {
      email: {
        type: "string",
        placeholder: "john.doe@example.com",
        description: "User email address",
        required: true
      },
      password: {
        type: "password",
        placeholder: "SecurePassword123!",
        description: "User password",
        required: true
      },
      mfa_code: {
        type: "string",
        placeholder: "123456",
        description: "Multi-factor authentication code (if MFA enabled)"
      },
      remember_me: {
        type: "boolean",
        defaultValue: false,
        description: "Extend refresh token expiry"
      }
    }
  }}
  sampleResponse={{
    "auth": {
      "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refresh_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "token_type": "Bearer",
      "expires_in": 3600
    },
    "user": {
      "id": "user_123456789",
      "email": "john.doe@example.com",
      "name": "John Doe",
      "role": "admin"
    }
  }}
/>

## Related Endpoints

<CardGroup cols={2}>
  <Card title="Logout" icon="right-from-bracket" href="/api/auth/logout">
    Invalidate current session
  </Card>
  <Card title="Refresh Token" icon="arrows-rotate" href="/api/auth/refresh">
    Refresh access token
  </Card>
  <Card title="Forgot Password" icon="key" href="/api/auth/forgot-password">
    Request password reset
  </Card>
  <Card title="Verify Email" icon="envelope-circle-check" href="/api/auth/verify-email">
    Verify email address
  </Card>
</CardGroup>