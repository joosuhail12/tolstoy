---
title: "Update Flow"
description: "Modify an existing workflow definition with version control, validation, and backward compatibility checks."
---

# Update Flow

Update an existing workflow definition with comprehensive validation, automatic version incrementing, and backward compatibility checks to ensure safe modifications.

## Endpoint

<CodeGroup>
```http HTTP
PUT /flows/{id}
```

```bash cURL
curl -X PUT "https://tolstoy.getpullse.com/flows/flow_abc123def456" \
  -H "x-org-id: org_1234567890abcdef" \
  -H "x-user-id: user_abcdef1234567890" \
  -H "Content-Type: application/json" \
  -d @updated-flow-definition.json
```
</CodeGroup>

## Path Parameters

| Parameter | Type | Description |
|-----------|------|-------------|
| `id` | string | **Required.** The unique identifier of the flow to update |

## Request Body

The request body should contain the updated flow definition. Only include fields you want to modify - partial updates are supported.

```json
{
  "name": "string",
  "description": "string",
  "inputs": [
    {
      "name": "string",
      "type": "string|number|boolean|object|array",
      "required": true,
      "description": "string",
      "default": "any",
      "validation": {}
    }
  ],
  "steps": [
    {
      "key": "string",
      "name": "string",
      "action": "string",
      "inputs": {},
      "executeIf": "string",
      "onError": {},
      "retryPolicy": {}
    }
  ],
  "outputs": [
    {
      "name": "string",
      "type": "string",
      "source": "string",
      "description": "string"
    }
  ],
  "settings": {
    "timeout": 300000,
    "retryPolicy": {
      "maxRetries": 3,
      "retryDelay": 1000,
      "backoffMultiplier": 2
    },
    "errorHandling": "stop|continue",
    "enableLogging": true,
    "enableMetrics": true
  },
  "tags": ["string"],
  "status": "draft|active|inactive"
}
```

### Update Options

You can include these optional fields to control the update behavior:

```json
{
  "update_options": {
    "version_increment": "major|minor|patch|auto",
    "force_update": false,
    "validate_before_save": true,
    "backup_current": true,
    "migration_strategy": "strict|lenient|force"
  }
}
```

| Field | Type | Default | Description |
|-------|------|---------|-------------|
| `version_increment` | string | "auto" | How to increment the version number |
| `force_update` | boolean | false | Override compatibility warnings |
| `validate_before_save` | boolean | true | Validate definition before saving |
| `backup_current` | boolean | true | Create backup of current version |
| `migration_strategy` | string | "strict" | How to handle breaking changes |

## Examples

### Basic Flow Update

<CodeGroup>
```json Add New Step
{
  "name": "Enhanced User Onboarding",
  "description": "User onboarding with improved CRM integration and team notifications",
  "steps": [
    {
      "key": "validate-email",
      "name": "Validate Email Address",
      "action": "email-validator",
      "inputs": {
        "email": "{{inputs.email}}"
      }
    },
    {
      "key": "create-crm-contact",
      "name": "Create CRM Contact",
      "action": "salesforce-create-contact",
      "inputs": {
        "email": "{{inputs.email}}",
        "firstName": "{{inputs.name | split(' ') | first}}",
        "lastName": "{{inputs.name | split(' ') | last}}",
        "source": "web-signup"
      },
      "executeIf": "{{steps.validate-email.outputs.valid}} == true"
    },
    {
      "key": "send-welcome-email",
      "name": "Send Welcome Email",
      "action": "sendgrid-send-email",
      "inputs": {
        "to": "{{inputs.email}}",
        "template": "welcome-v2",
        "variables": {
          "name": "{{inputs.name}}",
          "crmId": "{{steps.create-crm-contact.outputs.id}}"
        }
      },
      "executeIf": "{{steps.validate-email.outputs.valid}} == true"
    },
    {
      "key": "notify-sales-team",
      "name": "Notify Sales Team",
      "action": "slack-send-message",
      "inputs": {
        "channel": "#new-signups",
        "message": "ðŸŽ‰ New user signed up: {{inputs.name}} ({{inputs.email}}) - CRM ID: {{steps.create-crm-contact.outputs.id}}"
      },
      "executeIf": "{{steps.create-crm-contact.outputs.success}} == true"
    }
  ],
  "settings": {
    "timeout": 300000,
    "retryPolicy": {
      "maxRetries": 3,
      "retryDelay": 2000,
      "backoffMultiplier": 2
    },
    "errorHandling": "continue"
  },
  "tags": ["onboarding", "crm", "email", "notifications"],
  "update_options": {
    "version_increment": "minor",
    "validate_before_save": true
  }
}
```

```json Modify Existing Step
{
  "steps": [
    {
      "key": "validate-email",
      "name": "Enhanced Email Validation",
      "action": "advanced-email-validator",
      "inputs": {
        "email": "{{inputs.email}}",
        "check_mx": true,
        "check_disposable": true,
        "check_role_based": true
      },
      "retryPolicy": {
        "maxRetries": 2,
        "retryDelay": 1000
      }
    }
  ],
  "update_options": {
    "version_increment": "patch",
    "migration_strategy": "lenient"
  }
}
```

```json Update Settings and Configuration
{
  "settings": {
    "timeout": 600000,
    "retryPolicy": {
      "maxRetries": 5,
      "retryDelay": 3000,
      "backoffMultiplier": 1.5
    },
    "errorHandling": "continue",
    "enableLogging": true,
    "enableMetrics": true,
    "enableProfiling": true
  },
  "tags": ["onboarding", "crm", "email", "high-priority"],
  "update_options": {
    "version_increment": "patch"
  }
}
```
</CodeGroup>

### Advanced Update Scenarios

<CodeGroup>
```json Breaking Change with Migration
{
  "inputs": [
    {
      "name": "user_data",
      "type": "object",
      "required": true,
      "description": "Complete user information object",
      "validation": {
        "required": ["email", "name", "company"]
      }
    },
    {
      "name": "source",
      "type": "string",
      "required": false,
      "description": "Signup source",
      "default": "web",
      "validation": {
        "enum": ["web", "api", "mobile", "import"]
      }
    }
  ],
  "steps": [
    {
      "key": "extract-user-info",
      "name": "Extract User Information",
      "action": "data-transformer",
      "inputs": {
        "source": "{{inputs.user_data}}",
        "transformations": [
          {
            "field": "email",
            "operation": "extract",
            "path": "email"
          },
          {
            "field": "name",
            "operation": "extract", 
            "path": "name"
          },
          {
            "field": "company",
            "operation": "extract",
            "path": "company"
          }
        ]
      }
    },
    {
      "key": "validate-extracted-data",
      "name": "Validate User Data",
      "action": "data-validator",
      "inputs": {
        "email": "{{steps.extract-user-info.outputs.email}}",
        "name": "{{steps.extract-user-info.outputs.name}}",
        "company": "{{steps.extract-user-info.outputs.company}}"
      }
    }
  ],
  "update_options": {
    "version_increment": "major",
    "migration_strategy": "force",
    "force_update": true
  }
}
```

```json Conditional Logic Enhancement
{
  "steps": [
    {
      "key": "create-crm-contact",
      "name": "Create CRM Contact",
      "action": "salesforce-create-contact",
      "inputs": {
        "email": "{{inputs.email}}",
        "name": "{{inputs.name}}",
        "company": "{{inputs.company}}",
        "lead_source": "{{inputs.source}}",
        "priority": "{{inputs.company ? 'high' : 'normal'}}"
      },
      "executeIf": "{{steps.validate-email.outputs.valid}} == true && {{inputs.email | contains('@company.com') | not}}",
      "onError": {
        "action": "log-error",
        "inputs": {
          "message": "Failed to create CRM contact for {{inputs.email}}",
          "error_details": "{{error}}",
          "user_data": "{{inputs}}"
        },
        "continueOnError": true
      }
    },
    {
      "key": "create-internal-contact",
      "name": "Create Internal Contact",
      "action": "internal-user-creator",
      "inputs": {
        "email": "{{inputs.email}}",
        "name": "{{inputs.name}}",
        "department": "{{inputs.company}}"
      },
      "executeIf": "{{steps.validate-email.outputs.valid}} == true && {{inputs.email | contains('@company.com')}}"
    }
  ]
}
```
</CodeGroup>

## Request Examples

<CodeGroup>
```bash cURL - Partial Update
curl -X PUT "https://tolstoy.getpullse.com/flows/flow_abc123def456" \
  -H "x-org-id: org_1234567890abcdef" \
  -H "x-user-id: user_abcdef1234567890" \
  -H "Content-Type: application/json" \
  -d '{
    "description": "Updated user onboarding process with enhanced validation",
    "settings": {
      "timeout": 600000,
      "enableProfiling": true
    },
    "tags": ["onboarding", "enhanced", "production"],
    "update_options": {
      "version_increment": "minor",
      "validate_before_save": true
    }
  }'
```

```typescript TypeScript/Node.js
import { TolstoyClient } from '@joosuhail/tolstoy-sdk';

const client = new TolstoyClient({
  orgId: 'org_1234567890abcdef',
  userId: 'user_abcdef1234567890'
});

async function updateFlowWithNewStep(flowId: string) {
  try {
    // Get current flow
    const currentFlow = await client.flows.get(flowId);
    
    // Add new step to existing steps
    const updatedSteps = [
      ...currentFlow.definition.steps,
      {
        key: 'send-confirmation-sms',
        name: 'Send SMS Confirmation',
        action: 'twilio-send-sms',
        inputs: {
          to: '{{inputs.phone}}',
          message: 'Welcome {{inputs.name}}! Your account is ready.'
        },
        executeIf: '{{inputs.phone}} != null && {{inputs.phone}} != ""'
      }
    ];
    
    // Update the flow
    const updatedFlow = await client.flows.update(flowId, {
      steps: updatedSteps,
      description: currentFlow.description + ' with SMS notifications',
      update_options: {
        version_increment: 'minor',
        validate_before_save: true
      }
    });
    
    console.log(`Flow updated to version ${updatedFlow.version}`);
    console.log(`New step count: ${updatedFlow.definition.steps.length}`);
    
    return updatedFlow;
    
  } catch (error) {
    if (error.code === 'VALIDATION_ERROR') {
      console.error('Flow validation failed:', error.details);
    } else if (error.code === 'BREAKING_CHANGE_DETECTED') {
      console.error('Breaking change detected:', error.details.breaking_changes);
      console.log('Consider using force_update or adjusting migration_strategy');
    } else {
      console.error('Update failed:', error);
    }
    throw error;
  }
}

// Usage
updateFlowWithNewStep('flow_abc123def456');
```

```python Python
import tolstoy

client = tolstoy.Client(
    org_id='org_1234567890abcdef',
    user_id='user_abcdef1234567890'
)

def enhance_flow_error_handling(flow_id: str):
    try:
        # Get current flow
        current_flow = client.flows.get(flow_id)
        
        # Enhance each step with better error handling
        enhanced_steps = []
        for step in current_flow['definition']['steps']:
            enhanced_step = {
                **step,
                'onError': {
                    'action': 'log-and-notify',
                    'inputs': {
                        'step_name': step['name'],
                        'error_message': '{{error.message}}',
                        'execution_id': '{{execution.id}}',
                        'notification_channel': '#alerts'
                    },
                    'continueOnError': True
                },
                'retryPolicy': {
                    'maxRetries': 3,
                    'retryDelay': 2000,
                    'backoffMultiplier': 1.5
                }
            }
            enhanced_steps.append(enhanced_step)
        
        # Update with enhanced error handling
        updated_flow = client.flows.update(flow_id, {
            'steps': enhanced_steps,
            'description': current_flow['description'] + ' - Enhanced with robust error handling',
            'settings': {
                **current_flow['definition']['settings'],
                'errorHandling': 'continue',
                'enableLogging': True
            },
            'update_options': {
                'version_increment': 'minor',
                'validate_before_save': True
            }
        })
        
        print(f"Flow enhanced and updated to version {updated_flow['version']}")
        return updated_flow
        
    except Exception as error:
        print(f"Failed to enhance flow: {error}")
        raise error

# Usage
enhanced_flow = enhance_flow_error_handling('flow_abc123def456')
```
</CodeGroup>

## Response Format

### Success Response

```json
{
  "success": true,
  "data": {
    "id": "flow_abc123def456",
    "name": "Enhanced User Onboarding",
    "description": "User onboarding with improved CRM integration and team notifications",
    "version": 4,
    "status": "active",
    "definition": {
      "inputs": [...],
      "steps": [...],
      "outputs": [...],
      "settings": {...}
    },
    "tags": ["onboarding", "crm", "email", "notifications"],
    "created_at": "2024-01-15T08:30:00Z",
    "updated_at": "2024-01-20T11:15:45Z",
    "created_by": {...},
    "updated_by": {
      "id": "user_abcdef1234567890",
      "name": "John Doe",
      "email": "john@company.com"
    },
    "validation": {
      "valid": true,
      "warnings": [
        "New step 'notify-sales-team' has no retry policy configured"
      ],
      "errors": []
    },
    "update_summary": {
      "version_change": "3 â†’ 4",
      "changes_detected": [
        "Added new step: notify-sales-team",
        "Modified step: send-welcome-email (updated template)",
        "Updated settings: increased timeout from 300s to 600s",
        "Added tags: notifications"
      ],
      "breaking_changes": [],
      "compatibility_status": "backward_compatible"
    },
    "stats": {
      "total_executions": 1247,
      "successful_executions": 1198,
      "failed_executions": 49,
      "success_rate": 0.9607,
      "avg_duration_ms": 4580,
      "last_execution_at": "2024-01-20T09:45:22Z"
    }
  },
  "metadata": {
    "request_id": "req_xyz789abc123",
    "timestamp": "2024-01-20T11:15:45Z",
    "processing_time_ms": 230,
    "backup_created": "backup_flow_abc123def456_v3_20240120_111545"
  }
}
```

## Validation and Compatibility

### Validation Process

The update process includes comprehensive validation:

1. **Schema Validation**: Ensures the definition matches the expected schema
2. **Reference Validation**: Verifies all action and variable references are valid
3. **Logic Validation**: Checks conditional expressions and data flow
4. **Compatibility Check**: Identifies breaking changes from previous version
5. **Security Validation**: Ensures no security vulnerabilities are introduced

### Breaking Change Detection

The API automatically detects breaking changes:

- **Input Schema Changes**: Removing required inputs, changing input types
- **Output Schema Changes**: Removing or renaming outputs
- **Step Removal**: Removing steps that other steps depend on
- **Action Changes**: Changing action types or required parameters

### Migration Strategies

| Strategy | Behavior | Use Case |
|----------|----------|----------|
| `strict` | Reject any breaking changes | Production flows with active integrations |
| `lenient` | Allow non-critical breaking changes | Development and testing environments |
| `force` | Override all compatibility checks | Emergency fixes and major refactoring |

## Error Handling

### Common Error Responses

<CodeGroup>
```json 422 - Validation Error
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Flow definition validation failed",
    "details": {
      "field_errors": [
        {
          "field": "steps[3].action",
          "error": "Action 'slack-send-message' is not available in your organization"
        },
        {
          "field": "steps[2].executeIf",
          "error": "Invalid expression: steps.create-crm-contact.outputs.success"
        }
      ],
      "validation_warnings": [
        "Step 'notify-sales-team' has no error handling configured"
      ]
    }
  }
}
```

```json 409 - Breaking Changes Detected
{
  "success": false,
  "error": {
    "code": "BREAKING_CHANGE_DETECTED",
    "message": "Update contains breaking changes that require manual approval",
    "details": {
      "breaking_changes": [
        {
          "type": "input_removed",
          "description": "Required input 'company' was removed",
          "impact": "Existing executions may fail",
          "mitigation": "Make field optional or provide default value"
        },
        {
          "type": "step_removed",
          "description": "Step 'validate-phone' was removed",
          "impact": "Step 'send-sms' references removed step",
          "mitigation": "Update step references or add replacement step"
        }
      ],
      "suggested_actions": [
        "Set migration_strategy to 'lenient' or 'force'",
        "Use force_update: true to override warnings",
        "Consider creating a new flow instead of updating"
      ]
    }
  }
}
```

```json 423 - Flow Currently Executing
{
  "success": false,
  "error": {
    "code": "FLOW_IN_USE",
    "message": "Cannot update flow while executions are running",
    "details": {
      "active_executions": 3,
      "execution_ids": [
        "exec_xyz123",
        "exec_abc456", 
        "exec_def789"
      ],
      "suggested_actions": [
        "Wait for executions to complete",
        "Cancel running executions",
        "Create a new version instead of updating"
      ]
    }
  }
}
```
</CodeGroup>

## Best Practices

### Safe Update Strategy

1. **Test in Development First**: Always test updates in a development environment
2. **Use Semantic Versioning**: Choose appropriate version increment types
3. **Enable Validation**: Always validate before saving
4. **Create Backups**: Keep backups of working versions
5. **Gradual Rollout**: Update incrementally rather than making large changes

### Performance Considerations

1. **Batch Updates**: Group related changes into single update requests
2. **Avoid Frequent Updates**: Updates trigger re-validation which can be expensive
3. **Consider Impact**: Large flows may take longer to validate and update
4. **Monitor After Updates**: Watch execution metrics after updates

## Rate Limits

| Limit Type | Requests | Window | Notes |
|------------|----------|---------|-------|
| Per User | 50 | 1 hour | Individual user update limit |
| Per Organization | 200 | 1 hour | Organization-wide update limit |
| Per Flow | 10 | 1 hour | Updates per individual flow |

## Related Endpoints

<CardGroup cols={2}>
  <Card title="Get Flow" icon="eye" href="/api/resources/flows/get-flow">
    Retrieve current flow definition before updating
  </Card>
  <Card title="Validate Flow" icon="check-circle" href="/api/resources/flows/validate-flow">
    Validate changes without saving them
  </Card>
</CardGroup>

<CardGroup cols={2}>
  <Card title="Flow Versions" icon="history" href="/api/resources/flows/list-versions">
    View version history and rollback options
  </Card>
  <Card title="Flow Executions" icon="play" href="/api/resources/flows/list-executions">
    Monitor executions after updates
  </Card>
</CardGroup>

---

*Use the Update Flow endpoint to safely modify workflow definitions with automatic validation, version control, and compatibility checking. Always test changes thoroughly before applying to production flows.*