---
title: API Reference
sidebar_position: 8
---

# API Reference

Complete REST API documentation for the Tolstoy workflow automation platform. Build powerful integrations and automate your workflows programmatically.

## Base URL & Authentication

### Base URL
```
https://tolstoy.getpullse.com
```

### Authentication
All API requests require organization and user context headers:

```bash
curl https://tolstoy.getpullse.com/flows \
  -H "x-org-id: your-organization-id" \
  -H "x-user-id: your-user-id" \
  -H "Content-Type: application/json"
```

### Standard Response Format

All API responses follow this structure:

```json
{
  "success": true,
  "data": {
    // Response data
  },
  "meta": {
    "timestamp": "2024-01-15T10:30:00Z",
    "requestId": "req_abc123"
  }
}
```

Error responses:
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Invalid input parameters",
    "details": {
      "field": "name",
      "issue": "required"
    }
  },
  "meta": {
    "timestamp": "2024-01-15T10:30:00Z",
    "requestId": "req_abc123"
  }
}
```

## Organizations API

### Get Organization Details
```http
GET /organizations/{orgId}
```

Response:
```json
{
  "success": true,
  "data": {
    "id": "org_abc123",
    "name": "Acme Corporation",
    "plan": "enterprise",
    "createdAt": "2024-01-01T00:00:00Z",
    "settings": {
      "timezone": "UTC",
      "retentionDays": 90
    }
  }
}
```

## Tools API

### List Tools
```http
GET /tools
```

Query Parameters:
- `limit` (number): Maximum results (default: 50)
- `offset` (number): Pagination offset
- `search` (string): Search by name or description

### Create Tool
```http
POST /tools
```

Request Body:
```json
{
  "name": "GitHub API",
  "description": "GitHub REST API integration",
  "baseUrl": "https://api.github.com",
  "authType": "bearer",
  "version": "1.0",
  "headers": {
    "Accept": "application/vnd.github.v3+json"
  },
  "timeout": 30000
}
```

### Get Tool
```http
GET /tools/{toolId}
```

### Update Tool
```http
PATCH /tools/{toolId}
```

### Delete Tool
```http
DELETE /tools/{toolId}
```

### Test Tool Connection
```http
POST /tools/{toolId}/test
```

Request Body:
```json
{
  "endpoint": "/user",
  "method": "GET",
  "headers": {
    "Accept": "application/json"
  }
}
```

## Tool Secrets API

### Store Tool Secrets
```http
POST /tools/{toolId}/secrets
```

Request Body:
```json
{
  "api_token": "ghp_abc123def456...",
  "client_id": "oauth_client_123",
  "client_secret": "oauth_secret_456"
}
```

### Get Tool Secrets (Masked)
```http
GET /tools/{toolId}/secrets
```

Response:
```json
{
  "success": true,
  "data": {
    "secrets": {
      "api_token": "ghp_abc***456",
      "client_id": "oauth_***_123",
      "client_secret": "***"
    }
  }
}
```

## Actions API

### List Actions
```http
GET /actions
```

Query Parameters:
- `toolId` (string): Filter by tool ID
- `limit` (number): Maximum results
- `search` (string): Search by key or name

### Create Action
```http
POST /actions
```

Request Body:
```json
{
  "key": "github-create-issue",
  "name": "Create GitHub Issue",
  "toolId": "tool_abc123",
  "method": "POST",
  "endpoint": "/repos/{owner}/{repo}/issues",
  "headers": {
    "Accept": "application/vnd.github.v3+json"
  },
  "inputSchema": [
    {
      "name": "owner",
      "type": "string",
      "required": true,
      "description": "Repository owner"
    },
    {
      "name": "repo", 
      "type": "string",
      "required": true,
      "description": "Repository name"
    },
    {
      "name": "title",
      "type": "string",
      "required": true,
      "description": "Issue title"
    },
    {
      "name": "body",
      "type": "string",
      "required": false,
      "description": "Issue body"
    }
  ],
  "version": 1
}
```

### Get Action
```http
GET /actions/{actionId}
```

### Update Action
```http
PATCH /actions/{actionId}
```

### Delete Action
```http
DELETE /actions/{actionId}
```

## Flows API

### List Flows
```http
GET /flows
```

Query Parameters:
- `limit` (number): Maximum results
- `status` (string): Filter by status
- `search` (string): Search by name
- `sort` (string): Sort field and direction (e.g., `createdAt:desc`)

### Create Flow
```http
POST /flows
```

Request Body:
```json
{
  "name": "User Onboarding Workflow",
  "description": "Automated user onboarding process",
  "version": 1,
  "steps": [
    {
      "key": "validate-user",
      "action": "user-validator.validate",
      "inputs": {
        "email": "{{context.email}}",
        "requiredFields": ["name", "email"]
      }
    },
    {
      "key": "create-account",
      "action": "crm.create-user",
      "inputs": {
        "userData": "{{steps.validate-user.output}}"
      },
      "dependsOn": ["validate-user"]
    },
    {
      "key": "send-welcome-email",
      "action": "sendgrid.send-email",
      "inputs": {
        "to": "{{context.email}}",
        "template": "welcome-template",
        "data": {
          "userName": "{{steps.validate-user.output.name}}"
        }
      },
      "dependsOn": ["create-account"]
    }
  ],
  "retryPolicy": {
    "maxRetries": 3,
    "backoffStrategy": "exponential"
  },
  "timeout": 300000
}
```

### Get Flow
```http
GET /flows/{flowId}
```

### Update Flow
```http
PATCH /flows/{flowId}
```

### Delete Flow
```http
DELETE /flows/{flowId}
```

## Flow Execution API

### Execute Flow
```http
POST /flows/{flowId}/execute
```

Request Body:
```json
{
  "mode": "async",
  "inputs": {
    "email": "user@example.com",
    "name": "John Doe"
  },
  "retryPolicy": {
    "maxRetries": 5,
    "backoffStrategy": "linear"
  },
  "timeout": 600000
}
```

Parameters:
- `mode`: `"sync"` for immediate execution, `"async"` for durable execution
- `inputs`: Input data available as `{{context.key}}`
- `retryPolicy`: Override default retry settings
- `timeout`: Maximum execution time in milliseconds

### List Executions
```http
GET /flows/{flowId}/executions
```

Query Parameters:
- `status` (string): Filter by execution status
- `limit` (number): Maximum results
- `sort` (string): Sort order

### Get Execution Status
```http
GET /flows/{flowId}/executions/{executionId}
```

Response:
```json
{
  "success": true,
  "data": {
    "id": "exec_abc123",
    "flowId": "flow_abc123",
    "status": "completed",
    "startedAt": "2024-01-15T10:30:00Z",
    "completedAt": "2024-01-15T10:32:15Z",
    "duration": 135000,
    "inputs": {
      "email": "user@example.com"
    },
    "outputs": {
      "userId": "user_123",
      "accountCreated": true
    },
    "metrics": {
      "totalSteps": 3,
      "completedSteps": 3,
      "failedSteps": 0,
      "skippedSteps": 0
    }
  }
}
```

### Cancel Execution
```http
POST /flows/{flowId}/executions/{executionId}/cancel
```

### Retry Execution
```http
POST /flows/{flowId}/executions/{executionId}/retry
```

Request Body:
```json
{
  "fromStep": "failed-step-key",
  "retryPolicy": {
    "maxRetries": 3,
    "backoffStrategy": "exponential"
  }
}
```

## Execution Logs API

### Get Execution Logs
```http
GET /execution-logs
```

Query Parameters:
- `executionId` (string, required): Execution ID
- `stepKey` (string): Filter by specific step
- `status` (string): Filter by step status
- `limit` (number): Maximum results

Response:
```json
{
  "success": true,
  "data": {
    "logs": [
      {
        "id": "log_abc123",
        "executionId": "exec_abc123",
        "stepKey": "validate-user",
        "status": "completed",
        "startedAt": "2024-01-15T10:30:00Z",
        "completedAt": "2024-01-15T10:30:05Z",
        "duration": 5000,
        "inputs": {
          "email": "user@example.com"
        },
        "outputs": {
          "isValid": true,
          "userId": "user_123"
        },
        "error": null,
        "metrics": {
          "apiCalls": 1,
          "memoryUsage": 12.5
        }
      }
    ]
  }
}
```

## Webhooks API

### List Webhooks
```http
GET /webhooks
```

Query Parameters:
- `eventType` (string): Filter by event type
- `isActive` (boolean): Filter by active status

### Create Webhook
```http
POST /webhooks
```

Request Body:
```json
{
  "url": "https://your-app.com/webhook",
  "eventTypes": ["flow.completed", "flow.failed"],
  "isActive": true,
  "description": "Production workflow notifications"
}
```

### Get Webhook
```http
GET /webhooks/{webhookId}
```

### Update Webhook
```http
PATCH /webhooks/{webhookId}
```

### Delete Webhook
```http
DELETE /webhooks/{webhookId}
```

### Toggle Webhook Status
```http
PATCH /webhooks/{webhookId}/toggle
```

### Test Webhook
```http
POST /webhooks/{webhookId}/test
```

Request Body:
```json
{
  "eventType": "flow.completed",
  "testData": {
    "flowId": "flow_test",
    "executionId": "exec_test"
  }
}
```

### Get Webhook Deliveries
```http
GET /webhooks/{webhookId}/deliveries
```

## Metrics API

### Get Flow Metrics
```http
GET /flows/{flowId}/metrics
```

Request Body:
```json
{
  "timeRange": {
    "start": "2024-01-01T00:00:00Z",
    "end": "2024-01-31T23:59:59Z"
  },
  "granularity": "day",
  "metrics": [
    "execution_count",
    "success_rate", 
    "average_duration",
    "error_rate"
  ]
}
```

### Get Organization Metrics
```http
GET /metrics/organization
```

Response:
```json
{
  "success": true,
  "data": {
    "summary": {
      "totalFlows": 25,
      "activeFlows": 20,
      "totalExecutions": 5420,
      "successRate": 96.8
    },
    "topFlows": [
      {
        "flowId": "flow_abc123",
        "name": "User Onboarding",
        "executions": 1250,
        "successRate": 98.4
      }
    ]
  }
}
```

## Error Codes

| Code | HTTP Status | Description |
|------|-------------|-------------|
| `VALIDATION_ERROR` | 400 | Invalid request parameters |
| `UNAUTHORIZED` | 401 | Missing or invalid authentication |
| `FORBIDDEN` | 403 | Insufficient permissions |
| `NOT_FOUND` | 404 | Resource not found |
| `CONFLICT` | 409 | Resource already exists |
| `RATE_LIMITED` | 429 | Too many requests |
| `INTERNAL_ERROR` | 500 | Server error |
| `SERVICE_UNAVAILABLE` | 503 | Service temporarily unavailable |

## Rate Limits

| Endpoint Type | Limit | Window |
|---------------|-------|--------|
| **General API** | 1000 requests | per minute |
| **Flow Execution** | 100 requests | per minute |
| **Webhooks** | 500 requests | per minute |
| **Metrics** | 200 requests | per minute |

Rate limit headers:
```
X-RateLimit-Limit: 1000
X-RateLimit-Remaining: 850
X-RateLimit-Reset: 1640995200
```

## Pagination

Large result sets are paginated using cursor-based pagination:

```http
GET /flows?limit=20&cursor=eyJpZCI6ImZsb3dfYWJjMTIzIn0
```

Response includes pagination metadata:
```json
{
  "success": true,
  "data": {
    "flows": [...],
    "pagination": {
      "hasNext": true,
      "nextCursor": "eyJpZCI6ImZsb3dfZGVmNDU2In0",
      "limit": 20,
      "total": 150
    }
  }
}
```

## SDK Examples

### JavaScript/Node.js
```javascript
const TolstoyAPI = require('@tolstoy/sdk');

const client = new TolstoyAPI({
  orgId: 'your-org-id',
  userId: 'your-user-id',
  baseUrl: 'https://tolstoy.getpullse.com'
});

// Execute a flow
const execution = await client.flows.execute('flow_abc123', {
  mode: 'async',
  inputs: { email: 'user@example.com' }
});

// Monitor execution progress
const status = await client.flows.getExecutionStatus('flow_abc123', execution.id);
console.log('Status:', status.status);
```

### Python
```python
from tolstoy import TolstoyClient

client = TolstoyClient(
    org_id='your-org-id',
    user_id='your-user-id',
    base_url='https://tolstoy.getpullse.com'
)

# Create a tool
tool = client.tools.create({
    'name': 'GitHub API',
    'baseUrl': 'https://api.github.com',
    'authType': 'bearer'
})

# Execute a flow
execution = client.flows.execute('flow_abc123', {
    'mode': 'sync',
    'inputs': {'email': 'user@example.com'}
})
```

### cURL Examples

Execute flow:
```bash
curl -X POST https://tolstoy.getpullse.com/flows/flow_abc123/execute \
  -H "x-org-id: org_abc123" \
  -H "x-user-id: user_abc123" \
  -H "Content-Type: application/json" \
  -d '{
    "mode": "async",
    "inputs": {
      "email": "user@example.com"
    }
  }'
```

Get execution status:
```bash
curl https://tolstoy.getpullse.com/flows/flow_abc123/executions/exec_abc123 \
  -H "x-org-id: org_abc123" \
  -H "x-user-id: user_abc123"
```

## Postman Collection

Import our Postman collection for easy API testing:

```
https://tolstoy.getpullse.com/docs/postman-collection.json
```

## OpenAPI Specification

Download the complete OpenAPI 3.0 specification:

```
https://tolstoy.getpullse.com/docs/openapi.json
```

## Next Steps

- **[Webhooks Guide](/webhooks)** - Set up event-driven integrations
- **[Tools & Integrations](/tools)** - Connect external services
- **[Flow Definition Guide](/flow-definition)** - Build complex workflows
- **[Security Guide](/security)** - API security best practices