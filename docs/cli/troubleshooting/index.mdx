---
title: "CLI Troubleshooting Guide"
description: "Comprehensive troubleshooting guide for common Tolstoy CLI issues with step-by-step solutions and diagnostic tools."
---

# CLI Troubleshooting Guide

This comprehensive guide helps you diagnose and resolve common issues with the Tolstoy CLI, from installation problems to workflow execution failures.

## Quick Diagnostic Commands

Before diving into specific issues, run these commands to gather diagnostic information:

```bash
# Basic health check
tolstoy --version
tolstoy config test --verbose

# Show configuration details
tolstoy config debug

# Check connectivity
tolstoy config test --network-check

# View recent errors
tolstoy logs search "error\|failed" --since 1h --limit 10
```

## Installation Issues

### CLI Not Found After Installation

<details>
<summary>**Symptoms**: `command not found: tolstoy` after installation</summary>

**Possible Causes**:
- CLI not in PATH
- Installation failed silently
- Permission issues

**Solutions**:

```bash
# Check if CLI is installed but not in PATH
which tolstoy
find / -name "tolstoy" -type f 2>/dev/null

# Add to PATH (if found)
export PATH="$HOME/.tolstoy/bin:$PATH"
echo 'export PATH="$HOME/.tolstoy/bin:$PATH"' >> ~/.bashrc

# Reinstall via npm
npm uninstall -g @tolstoy/cli
npm install -g @tolstoy/cli

# Check npm global bin directory
npm bin -g
ls -la $(npm bin -g)/tolstoy

# Fix permissions (macOS/Linux)
sudo chown -R $(whoami) $(npm config get prefix)/{lib/node_modules,bin,share}
```
</details>

### Installation Fails with Permission Errors

<details>
<summary>**Symptoms**: `EACCES` or permission denied during installation</summary>

**Solutions**:

```bash
# Option 1: Use sudo (not recommended for npm)
sudo npm install -g @tolstoy/cli

# Option 2: Configure npm to use different directory
mkdir ~/.npm-global
npm config set prefix '~/.npm-global'
export PATH=~/.npm-global/bin:$PATH
echo 'export PATH=~/.npm-global/bin:$PATH' >> ~/.bashrc
npm install -g @tolstoy/cli

# Option 3: Use nvm (recommended)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install node
npm install -g @tolstoy/cli

# Option 4: Use alternative installation method
curl -fsSL https://get.tolstoy.dev | bash
```
</details>

### Version Mismatch or Outdated CLI

<details>
<summary>**Symptoms**: CLI behaves unexpectedly or API errors about unsupported features</summary>

**Solutions**:

```bash
# Check current version
tolstoy --version

# Check available versions
npm view @tolstoy/cli versions --json

# Update to latest version
npm update -g @tolstoy/cli

# Install specific version
npm install -g @tolstoy/cli@1.2.3

# Clear npm cache if update fails
npm cache clean --force
npm install -g @tolstoy/cli

# Alternative update method
curl -fsSL https://get.tolstoy.dev | bash
```
</details>

## Configuration and Authentication Issues

### Configuration File Corrupted

<details>
<summary>**Symptoms**: `Error: Failed to parse configuration file`</summary>

**Solutions**:

```bash
# Validate configuration file
tolstoy config validate --file ~/.tolstoy/config/config.json

# Show configuration file contents
cat ~/.tolstoy/config/config.json | jq .

# Backup and reset configuration
cp ~/.tolstoy/config/config.json ~/.tolstoy/config/config.json.backup
tolstoy config reset

# Restore from backup
tolstoy config import ~/.tolstoy/config/config.json.backup

# Manual repair (if JSON is malformed)
cp ~/.tolstoy/config/config.json /tmp/config-broken.json
echo '{}' > ~/.tolstoy/config/config.json
tolstoy config add default --interactive
```
</details>

### Authentication Failures

<details>
<summary>**Symptoms**: `Authentication failed`, `Invalid API key`, `Token expired`</summary>

**API Key Issues**:
```bash
# Check if API key is set
tolstoy config get api-key --masked

# Verify API key format
echo $TOLSTOY_API_KEY | grep -E '^tk_(live|test)_[a-zA-Z0-9]{40,}$'

# Test with verbose output
tolstoy config test --verbose

# Regenerate API key
# 1. Go to Tolstoy dashboard → Settings → API Keys
# 2. Create new key
# 3. Update CLI configuration
tolstoy config set api-key

# Clear cached credentials
rm -rf ~/.tolstoy/auth/
tolstoy config set api-key --from-env
```

**OAuth Issues**:
```bash
# Check OAuth status
tolstoy config auth status

# Refresh OAuth tokens
tolstoy config auth refresh

# Clear OAuth tokens and re-authenticate
tolstoy config auth revoke
tolstoy config auth oauth

# Manual token refresh (if auto-refresh fails)
tolstoy config auth refresh --force

# Check token expiration
tolstoy config auth info --show-expiration
```

**Service Account Issues**:
```bash
# Validate service account file
jq . service-account.json

# Check service account expiration
jq '.expires_at' service-account.json

# Test service account authentication
tolstoy config test --auth-method service-account --verbose

# Update service account
tolstoy config set service-account-file ./new-service-account.json
```
</details>

### Profile Issues

<details>
<summary>**Symptoms**: `Profile not found`, `Cannot switch profiles`</summary>

**Solutions**:

```bash
# List all profiles
tolstoy config list

# Check current profile
tolstoy config current

# Create missing profile
tolstoy config add missing-profile --interactive

# Reset to default profile
tolstoy config use default

# Fix profile corruption
tolstoy config validate --all-profiles

# Export/import profile
tolstoy config export --profile production > production-backup.json
tolstoy config delete production
tolstoy config import production-backup.json

# Check profile file directly
ls -la ~/.tolstoy/config/profiles/
cat ~/.tolstoy/config/profiles/production.json | jq .
```
</details>

## Network and Connectivity Issues

### Connection Timeouts

<details>
<summary>**Symptoms**: `Connection timeout`, `Request timeout`, `ETIMEDOUT`</summary>

**Solutions**:

```bash
# Test network connectivity
ping api.tolstoy.com
curl -I https://api.tolstoy.com/health

# Test with increased timeout
tolstoy config test --timeout 60s

# Check proxy settings
echo $HTTP_PROXY
echo $HTTPS_PROXY
echo $NO_PROXY

# Configure proxy if needed
tolstoy config set proxy http://proxy.company.com:8080

# Test DNS resolution
nslookup api.tolstoy.com
dig api.tolstoy.com

# Use alternative API endpoint if available
tolstoy config set api-url https://api-backup.tolstoy.com

# Check firewall/security software
# Ensure ports 80 and 443 are open for outbound connections
```
</details>

### SSL/TLS Certificate Issues

<details>
<summary>**Symptoms**: `SSL certificate error`, `CERT_UNTRUSTED`, `SSL_ERROR_SYSCALL`</summary>

**Solutions**:

```bash
# Test SSL connection
openssl s_client -connect api.tolstoy.com:443

# Check certificate details
curl -vI https://api.tolstoy.com

# Update CA certificates (Linux)
sudo apt-get update && sudo apt-get install ca-certificates

# Update CA certificates (macOS)
brew install ca-certificates

# Bypass SSL verification (temporary, not recommended)
export NODE_TLS_REJECT_UNAUTHORIZED=0
tolstoy config test

# Configure custom CA certificates
export SSL_CERT_FILE=/path/to/custom-ca-bundle.crt
tolstoy config test

# Check system clock (SSL certificates are time-sensitive)
date
sudo ntpdate -s time.nist.gov  # Linux
sudo sntp -sS time.apple.com   # macOS
```
</details>

### API Rate Limiting

<details>
<summary>**Symptoms**: `Rate limit exceeded`, `429 Too Many Requests`</summary>

**Solutions**:

```bash
# Check rate limit status
tolstoy config auth info --show-rate-limits

# Wait and retry
sleep 60
tolstoy config test

# Configure retry policy
tolstoy config set retry-attempts 5
tolstoy config set retry-delay 2s

# Use exponential backoff
tolstoy config set retry-backoff exponential

# Check for concurrent processes
ps aux | grep tolstoy

# Reduce concurrent operations
export TOLSTOY_CONCURRENT_REQUESTS=1
tolstoy flows list
```
</details>

## Workflow Execution Issues

### Workflow Validation Errors

<details>
<summary>**Symptoms**: Workflow fails validation, schema errors</summary>

**Solutions**:

```bash
# Validate workflow with detailed output
tolstoy flows validate workflow.yml --verbose

# Check YAML syntax
yamllint workflow.yml

# Validate JSON format
cat workflow.yml | yq . | jq .

# Common validation fixes:

# Fix indentation issues
sed 's/\t/  /g' workflow.yml > workflow-fixed.yml

# Check for missing required fields
tolstoy flows validate workflow.yml 2>&1 | grep -i "required"

# Validate action references
tolstoy actions list | grep -E "action_name"

# Check input schema
tolstoy flows validate workflow.yml --check-inputs

# Example: Fix common issues
# 1. Ensure proper YAML structure
# 2. Quote string values that contain special characters
# 3. Use correct action keys from `tolstoy actions list`
# 4. Validate input/output parameter names
```
</details>

### Workflow Execution Failures

<details>
<summary>**Symptoms**: Workflows fail during execution</summary>

**Debug Steps**:

```bash
# Get detailed execution information
tolstoy logs get exec_failed_id --verbose --include-stack-trace

# Execute with debug mode
tolstoy flows execute workflow-id --input '{}' --debug --verbose

# Check tool connectivity
tolstoy tools test --all

# Test with minimal input
tolstoy flows execute workflow-id --input '{}' --dry-run

# Check action availability
tolstoy actions list | grep action_name

# Verify tool configurations
tolstoy tools get tool-id --show-config

# Check for common issues:
# 1. Missing or invalid inputs
# 2. Tool authentication failures
# 3. Network connectivity to external services
# 4. Timeout issues
```

**Common Fixes**:

```bash
# Fix timeout issues
tolstoy config set timeout 300s

# Update tool credentials
tolstoy tools auth update tool-id --api-key new-key

# Check tool health
tolstoy tools health tool-id --verbose

# Retry failed execution
tolstoy flows retry exec_failed_id

# Execute with different inputs
tolstoy flows execute workflow-id --input-file corrected-inputs.json
```
</details>

### Action Execution Issues

<details>
<summary>**Symptoms**: Individual actions fail within workflows</summary>

**Solutions**:

```bash
# Test action independently
tolstoy actions execute action-key --input '{"test": "value"}' --verbose

# Check action schema
tolstoy actions get action-key --show-schema

# Validate action inputs
tolstoy actions execute action-key --input '{}' --dry-run

# Check action dependencies (tools)
tolstoy tools health action-tool-id

# Debug with minimal input
tolstoy actions execute action-key --input '{}' --debug

# Check action logs
tolstoy logs search "action-key" --since 1h

# Update action if custom
tolstoy actions update action-key updated-action.yml

# Verify tool permissions
tolstoy tools test action-tool-id --check-permissions
```
</details>

## Performance Issues

### Slow CLI Response

<details>
<summary>**Symptoms**: CLI commands take unusually long to complete</summary>

**Solutions**:

```bash
# Check network latency
ping api.tolstoy.com

# Test with timing
time tolstoy config test

# Clear CLI cache
rm -rf ~/.tolstoy/cache/

# Reduce output verbosity
tolstoy flows list --quiet

# Use JSON output (faster parsing)
tolstoy flows list --output json

# Check system resources
top | grep node
df -h ~/.tolstoy/

# Increase timeout for slow networks
tolstoy config set timeout 120s

# Check for proxy issues
unset HTTP_PROXY HTTPS_PROXY
tolstoy config test

# Use pagination for large lists
tolstoy flows list --limit 10 --offset 0
```
</details>

### Memory Issues

<details>
<summary>**Symptoms**: CLI crashes with memory errors, `JavaScript heap out of memory`</summary>

**Solutions**:

```bash
# Increase Node.js memory limit
export NODE_OPTIONS="--max-old-space-size=4096"
tolstoy flows list

# Clear cache and temporary files
rm -rf ~/.tolstoy/cache/
rm -rf /tmp/tolstoy-*

# Process large datasets in chunks
tolstoy flows list --limit 50 | while read -r flow; do
  # Process each flow individually
  tolstoy flows get "$flow"
done

# Use streaming for large exports
tolstoy logs export --stream --since 30d | gzip > logs.json.gz

# Check available disk space
df -h ~/.tolstoy/

# Monitor memory usage
ps aux | grep node
```
</details>

## Tool Integration Issues

### Tool Connection Failures

<details>
<summary>**Symptoms**: Tools show as disconnected or unhealthy</summary>

**Solutions**:

```bash
# Test specific tool
tolstoy tools test tool-id --verbose

# Check tool configuration
tolstoy tools get tool-id --show-config --show-secrets

# Update tool credentials
tolstoy tools auth update tool-id

# Check network connectivity to tool endpoint
curl -I https://api.external-service.com

# Test with minimal configuration
tolstoy tools create test-tool.yml

# Check tool health over time
tolstoy tools health tool-id --since 24h

# Verify SSL certificates for external services
openssl s_client -connect external-service.com:443

# Check rate limits
tolstoy tools test tool-id --check-rate-limits

# Reset tool authentication
tolstoy tools auth reset tool-id
tolstoy tools auth setup tool-id
```
</details>

### Tool Authentication Issues

<details>
<summary>**Symptoms**: Tool authentication fails, expired tokens</summary>

**Solutions**:

```bash
# Check authentication status
tolstoy tools auth status tool-id

# Refresh OAuth tokens
tolstoy tools auth refresh tool-id

# Update API credentials
tolstoy tools auth update tool-id --interactive

# Check token expiration
tolstoy tools auth info tool-id --show-expiration

# Test with new credentials
tolstoy tools test tool-id --ignore-cache

# Verify external service status
curl -H "Authorization: Bearer token" https://api.service.com/health

# Recreate tool configuration
tolstoy tools export tool-id > tool-backup.yml
tolstoy tools delete tool-id
tolstoy tools create tool-backup.yml

# Check service-specific troubleshooting:

# Slack
tolstoy tools test slack-tool --check-permissions

# Database
tolstoy tools test db-tool --check-connection

# HTTP APIs
tolstoy tools test api-tool --check-endpoint
```
</details>

## Log and Output Issues

### Missing or Incomplete Logs

<details>
<summary>**Symptoms**: Logs not showing up, incomplete execution information</summary>

**Solutions**:

```bash
# Check log retention settings
tolstoy logs retention show

# Search with broader criteria
tolstoy logs search "." --since 7d --limit 100

# Check different log levels
tolstoy logs list --level debug --since 1h

# Verify execution IDs
tolstoy flows list --output json | jq -r '.[].latest_execution_id'

# Check log permissions
ls -la ~/.tolstoy/logs/

# Clear log cache
rm -rf ~/.tolstoy/cache/logs/

# Enable debug logging
export TOLSTOY_LOG_LEVEL=debug
tolstoy flows execute workflow-id --input '{}'

# Check system logs
tail -f ~/.tolstoy/logs/tolstoy.log

# Force log sync
tolstoy logs sync --force
```
</details>

### Output Formatting Issues

<details>
<summary>**Symptoms**: Garbled output, formatting problems, encoding issues</summary>

**Solutions**:

```bash
# Check terminal encoding
echo $LANG
locale

# Force UTF-8 encoding
export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8

# Disable colors if causing issues
tolstoy config set color-output false
tolstoy flows list

# Use different output format
tolstoy flows list --output json
tolstoy flows list --output yaml

# Check terminal size
echo $COLUMNS $LINES
resize

# Reset terminal
reset
clear

# Check font support
echo "Test: ✓ ✗ ⚠ 🔄"

# Use simple table format
tolstoy flows list --output table --no-colors --no-unicode

# Pipe through pager
tolstoy flows list | less
```
</details>

## Advanced Troubleshooting

### Debug Mode and Logging

```bash
# Enable comprehensive debugging
export TOLSTOY_DEBUG=true
export TOLSTOY_LOG_LEVEL=debug
export TOLSTOY_VERBOSE=true

# Save debug output to file
tolstoy flows execute workflow-id --input '{}' --debug 2>&1 | tee debug.log

# Network debugging
export TOLSTOY_DEBUG_NETWORK=true
tolstoy config test

# Authentication debugging
export TOLSTOY_DEBUG_AUTH=true
tolstoy config auth status

# Disable debugging
unset TOLSTOY_DEBUG TOLSTOY_LOG_LEVEL TOLSTOY_VERBOSE
```

### System Information Collection

```bash
#!/bin/bash
# collect-system-info.sh - Collect diagnostic information

echo "=== Tolstoy CLI Diagnostic Information ==="
echo "Timestamp: $(date)"
echo

echo "=== System Information ==="
uname -a
echo "Node.js: $(node --version 2>/dev/null || echo 'Not found')"
echo "npm: $(npm --version 2>/dev/null || echo 'Not found')"
echo

echo "=== Tolstoy CLI Information ==="
echo "Version: $(tolstoy --version 2>/dev/null || echo 'Not installed')"
echo "Installation path: $(which tolstoy 2>/dev/null || echo 'Not found')"
echo

echo "=== Configuration ==="
tolstoy config current 2>/dev/null || echo "Configuration error"
tolstoy config test --timeout 10s 2>&1 || echo "Connection test failed"
echo

echo "=== Network ==="
ping -c 1 api.tolstoy.com 2>/dev/null || echo "Cannot reach api.tolstoy.com"
curl -I https://api.tolstoy.com/health 2>/dev/null || echo "HTTPS connection failed"
echo

echo "=== Environment Variables ==="
env | grep -i tolstoy || echo "No Tolstoy environment variables set"
echo

echo "=== Recent Errors ==="
tolstoy logs search "error\|failed" --since 1h --limit 5 2>/dev/null || echo "Cannot access logs"
echo

echo "=== Disk Space ==="
df -h ~/.tolstoy 2>/dev/null || echo "CLI directory not found"
echo

echo "=== End of Diagnostic Information ==="
```

### Configuration Backup and Recovery

```bash
# Create complete backup
tolstoy config backup --include-auth > tolstoy-backup-$(date +%Y%m%d).tar.gz

# Minimal recovery process
mkdir ~/.tolstoy-recovery
cd ~/.tolstoy-recovery

# Extract backup
tar -xzf tolstoy-backup-20240120.tar.gz

# Restore configuration
tolstoy config import config.json

# Test recovery
tolstoy config test

# Clean up
rm -rf ~/.tolstoy-recovery
```

## Getting Help

### Community Support

- **GitHub Issues**: Report bugs and feature requests
- **Documentation**: Check the latest documentation
- **Community Forum**: Ask questions and share solutions

### Professional Support

For enterprise customers:
- **Support Portal**: Access priority support channels
- **Account Manager**: Contact your dedicated account manager
- **Professional Services**: Get help with implementation

### Useful Resources

```bash
# Show all available help
tolstoy --help

# Command-specific help
tolstoy flows --help
tolstoy config --help

# Check CLI health
tolstoy config doctor

# Export diagnostic information
tolstoy config debug --export > diagnostic-info.json
```

## Prevention and Best Practices

### Regular Maintenance

```bash
#!/bin/bash
# cli-maintenance.sh - Regular CLI maintenance

# Update CLI
npm update -g @tolstoy/cli

# Clear cache
rm -rf ~/.tolstoy/cache/

# Validate configuration
tolstoy config validate --all-profiles

# Test connectivity
tolstoy config test --all-profiles

# Clean up old logs
find ~/.tolstoy/logs -name "*.log" -mtime +30 -delete

# Update tools
tolstoy tools health --all --fix-issues

# Generate health report
tolstoy config doctor > health-report-$(date +%Y%m%d).txt
```

### Monitoring Scripts

```bash
#!/bin/bash
# monitor-cli-health.sh - Monitor CLI health

# Check CLI responsiveness
if ! timeout 30s tolstoy config test >/dev/null 2>&1; then
    echo "CLI health check failed"
    # Send alert
    curl -X POST "$SLACK_WEBHOOK" \
        -d '{"text":"🚨 Tolstoy CLI health check failed"}'
fi

# Check disk space
USAGE=$(df ~/.tolstoy | tail -1 | awk '{print $5}' | sed 's/%//')
if [ "$USAGE" -gt 80 ]; then
    echo "High disk usage in ~/.tolstoy: ${USAGE}%"
fi

# Check for errors in logs
ERROR_COUNT=$(tolstoy logs search "error" --since 1h --count 2>/dev/null || echo 0)
if [ "$ERROR_COUNT" -gt 10 ]; then
    echo "High error count in last hour: $ERROR_COUNT"
fi
```

---

*This troubleshooting guide covers the most common issues you may encounter with the Tolstoy CLI. If you continue to experience problems after trying these solutions, don't hesitate to reach out to support or the community for assistance.*