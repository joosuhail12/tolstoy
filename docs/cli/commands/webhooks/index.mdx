---
title: "Webhooks Commands"
description: "Manage webhook endpoints, configure event subscriptions, and monitor webhook delivery using the Tolstoy CLI webhook commands."
---

# Webhooks Commands

The `tolstoy webhooks` command group provides comprehensive webhook management capabilities. Use these commands to create webhook endpoints, configure event subscriptions, and monitor webhook delivery for real-time workflow integration.

## Quick Reference

| Command | Description | Usage |
|---------|-------------|--------|
| `list` | List all webhook endpoints | `tolstoy webhooks list [options]` |
| `get` | Get webhook configuration details | `tolstoy webhooks get <webhook-id>` |
| `create` | Create new webhook endpoint | `tolstoy webhooks create [options]` |
| `update` | Update webhook configuration | `tolstoy webhooks update <webhook-id> [options]` |
| `delete` | Delete webhook endpoint | `tolstoy webhooks delete <webhook-id>` |
| `test` | Test webhook endpoint | `tolstoy webhooks test <webhook-id>` |
| `events` | Manage event subscriptions | `tolstoy webhooks events <subcommand>` |
| `logs` | View webhook delivery logs | `tolstoy webhooks logs <webhook-id>` |
| `retry` | Retry failed webhook deliveries | `tolstoy webhooks retry <delivery-id>` |

## Common Usage Patterns

### Basic Webhook Management

```bash
# List all webhooks
tolstoy webhooks list

# Create a new webhook
tolstoy webhooks create \
  --url "https://api.example.com/webhooks/tolstoy" \
  --events "flow.completed,flow.failed" \
  --secret "webhook_secret_123"

# Get webhook details
tolstoy webhooks get webhook_abc123def456

# Test webhook connectivity
tolstoy webhooks test webhook_abc123def456

# Update webhook URL
tolstoy webhooks update webhook_abc123def456 \
  --url "https://api.example.com/v2/webhooks/tolstoy"
```

### Event Management

```bash
# List available event types
tolstoy webhooks events list-types

# Subscribe to specific events
tolstoy webhooks events subscribe webhook_abc123def456 \
  --events "action.completed,action.failed,execution.started"

# Unsubscribe from events
tolstoy webhooks events unsubscribe webhook_abc123def456 \
  --events "execution.started"

# View current subscriptions
tolstoy webhooks events subscriptions webhook_abc123def456
```

### Monitoring and Troubleshooting

```bash
# View webhook delivery logs
tolstoy webhooks logs webhook_abc123def456 --since 24h

# Check failed deliveries
tolstoy webhooks logs webhook_abc123def456 --status failed --since 1h

# Retry failed delivery
tolstoy webhooks retry delivery_def456ghi789

# View delivery statistics
tolstoy webhooks stats webhook_abc123def456 --since 7d
```

## Webhook Configuration

### Creating Webhooks

<CodeGroup>
```bash Basic Webhook Creation
# Create webhook with minimal configuration
tolstoy webhooks create \
  --url "https://api.example.com/webhooks/tolstoy" \
  --events "flow.completed" \
  --description "Production flow completion notifications"

# Response:
# ✅ Webhook created successfully
# ID: webhook_abc123def456
# URL: https://api.example.com/webhooks/tolstoy
# Secret: whsec_generated_secret_here
```

```bash Advanced Webhook Configuration
# Create webhook with comprehensive settings
tolstoy webhooks create \
  --url "https://api.example.com/webhooks/tolstoy" \
  --events "flow.started,flow.completed,flow.failed,action.failed" \
  --secret "my_custom_secret_123" \
  --description "Comprehensive workflow monitoring" \
  --headers "X-Source=Tolstoy,X-Environment=Production" \
  --timeout 30s \
  --retry-attempts 5 \
  --retry-delay 2s \
  --active true
```

```bash Webhook from Configuration File
# Create webhook from YAML configuration
cat > webhook-config.yml << EOF
url: "https://api.example.com/webhooks/tolstoy"
description: "GitHub integration webhook"
events:
  - "flow.completed"
  - "flow.failed" 
  - "action.completed"
  - "action.failed"
headers:
  X-Source: "Tolstoy"
  X-Environment: "Production"
  Authorization: "Bearer ${WEBHOOK_TOKEN}"
timeout: "30s"
retry_policy:
  max_attempts: 5
  initial_delay: "2s"
  max_delay: "60s" 
  backoff_factor: 2
filters:
  flows:
    - "production-*"
    - "critical-*"
  exclude_test: true
EOF

tolstoy webhooks create --config webhook-config.yml
```

```bash Conditional Webhooks
# Create webhook with conditional delivery
tolstoy webhooks create \
  --url "https://api.example.com/webhooks/critical" \
  --events "flow.failed,action.failed" \
  --condition "event.severity == 'high' OR event.flow.tags contains 'critical'" \
  --description "Critical failure notifications only"
```
</CodeGroup>

### Webhook Event Types

| Event Category | Event Type | Description |
|----------------|------------|-------------|
| **Flow Events** | `flow.started` | Workflow execution started |
| | `flow.completed` | Workflow completed successfully |
| | `flow.failed` | Workflow execution failed |
| | `flow.timeout` | Workflow execution timed out |
| | `flow.cancelled` | Workflow execution was cancelled |
| **Action Events** | `action.started` | Action execution started |
| | `action.completed` | Action completed successfully |
| | `action.failed` | Action execution failed |
| | `action.retrying` | Action is being retried |
| **Tool Events** | `tool.connected` | Tool connection established |
| | `tool.disconnected` | Tool connection lost |
| | `tool.auth_expired` | Tool authentication expired |
| **System Events** | `system.maintenance_start` | System maintenance starting |
| | `system.maintenance_end` | System maintenance completed |
| | `system.alert` | System alert triggered |

### Event Payload Structure

All webhook events follow a consistent payload structure:

```json
{
  "id": "event_abc123def456",
  "type": "flow.completed",
  "timestamp": "2024-01-20T15:30:00Z",
  "webhook_id": "webhook_def456ghi789",
  "organization_id": "org_1234567890abcdef",
  "data": {
    "execution_id": "exec_ghi789jkl012",
    "flow_id": "flow_user_onboarding",
    "flow_name": "User Onboarding Flow", 
    "status": "completed",
    "duration_ms": 42150,
    "started_at": "2024-01-20T15:29:18Z",
    "completed_at": "2024-01-20T15:30:00Z",
    "user_id": "user_alice_123456",
    "inputs": {
      "email": "user@example.com",
      "name": "John Doe"
    },
    "outputs": {
      "crm_contact_id": "contact_sf_abc123",
      "welcome_email_id": "email_sg_def456"
    },
    "steps": [
      {
        "key": "validate-email",
        "name": "Validate Email Address",
        "status": "completed",
        "duration_ms": 4200
      }
    ]
  },
  "metadata": {
    "environment": "production",
    "source": "api",
    "tags": ["user-onboarding", "production"]
  }
}
```

## Event Filtering and Routing

### Basic Filtering

```bash
# Filter by flow patterns
tolstoy webhooks create \
  --url "https://api.example.com/webhooks/production" \
  --events "flow.completed,flow.failed" \
  --filter-flows "production-*,critical-*"

# Filter by user actions
tolstoy webhooks create \
  --url "https://api.example.com/webhooks/user-actions" \
  --events "flow.started" \
  --filter-users "user_admin_*,user_operator_*"

# Exclude test executions
tolstoy webhooks create \
  --url "https://api.example.com/webhooks/real-events" \
  --events "flow.*" \
  --exclude-test-executions
```

### Advanced Filtering with Conditions

```bash
# Complex condition-based filtering
tolstoy webhooks create \
  --url "https://api.example.com/webhooks/alerts" \
  --events "flow.failed,action.failed" \
  --condition '
    (event.type == "flow.failed" AND event.data.duration_ms > 300000) OR
    (event.type == "action.failed" AND event.data.error.type == "TIMEOUT") OR
    (event.data.tags contains "critical")
  ' \
  --description "High-priority failure alerts"

# Time-based filtering
tolstoy webhooks create \
  --url "https://api.example.com/webhooks/business-hours" \
  --events "flow.completed" \
  --condition '
    hour(event.timestamp) >= 9 AND 
    hour(event.timestamp) <= 17 AND
    weekday(event.timestamp) <= 5
  ' \
  --description "Business hours completions only"
```

### Event Routing

```bash
# Route different events to different endpoints
tolstoy webhooks create \
  --url "https://alerts.example.com/webhooks/failures" \
  --events "flow.failed,action.failed" \
  --description "Failure notifications"

tolstoy webhooks create \
  --url "https://analytics.example.com/webhooks/completions" \
  --events "flow.completed" \
  --description "Success analytics"

tolstoy webhooks create \
  --url "https://monitoring.example.com/webhooks/all" \
  --events "*" \
  --description "Complete event monitoring"
```

## Webhook Security

### Signature Verification

All webhooks include signature verification for security:

<CodeGroup>
```javascript Node.js Signature Verification
const crypto = require('crypto');
const express = require('express');

const app = express();
app.use(express.raw({type: 'application/json'}));

app.post('/webhooks/tolstoy', (req, res) => {
  const payload = req.body;
  const signature = req.headers['tolstoy-signature'];
  const timestamp = req.headers['tolstoy-timestamp'];
  const webhookSecret = process.env.TOLSTOY_WEBHOOK_SECRET;
  
  // Verify timestamp (prevent replay attacks)
  const currentTime = Math.floor(Date.now() / 1000);
  if (Math.abs(currentTime - parseInt(timestamp)) > 300) {
    return res.status(401).send('Request too old');
  }
  
  // Verify signature
  const expectedSignature = crypto
    .createHmac('sha256', webhookSecret)
    .update(timestamp + '.' + payload)
    .digest('hex');
    
  const providedSignature = signature.replace('sha256=', '');
  
  if (!crypto.timingSafeEqual(
    Buffer.from(expectedSignature), 
    Buffer.from(providedSignature)
  )) {
    return res.status(401).send('Invalid signature');
  }
  
  // Process webhook
  const event = JSON.parse(payload);
  console.log('Received event:', event.type);
  
  res.status(200).send('OK');
});
```

```python Python Signature Verification
import hmac
import hashlib
import time
from flask import Flask, request, abort

app = Flask(__name__)

@app.route('/webhooks/tolstoy', methods=['POST'])
def handle_webhook():
    payload = request.data
    signature = request.headers.get('Tolstoy-Signature', '')
    timestamp = request.headers.get('Tolstoy-Timestamp', '')
    webhook_secret = os.environ['TOLSTOY_WEBHOOK_SECRET']
    
    # Verify timestamp
    current_time = int(time.time())
    if abs(current_time - int(timestamp)) > 300:
        abort(401, 'Request too old')
    
    # Verify signature  
    expected_signature = hmac.new(
        webhook_secret.encode(),
        f"{timestamp}.{payload.decode()}".encode(),
        hashlib.sha256
    ).hexdigest()
    
    provided_signature = signature.replace('sha256=', '')
    
    if not hmac.compare_digest(expected_signature, provided_signature):
        abort(401, 'Invalid signature')
    
    # Process webhook
    event = request.json
    print(f"Received event: {event['type']}")
    
    return 'OK', 200
```

```go Go Signature Verification
package main

import (
    "crypto/hmac"
    "crypto/sha256"
    "encoding/hex"
    "encoding/json"
    "fmt"
    "io/ioutil"
    "net/http"
    "os"
    "strconv"
    "time"
)

func webhookHandler(w http.ResponseWriter, r *http.Request) {
    payload, err := ioutil.ReadAll(r.Body)
    if err != nil {
        http.Error(w, "Error reading body", 400)
        return
    }
    
    signature := r.Header.Get("Tolstoy-Signature")
    timestamp := r.Header.Get("Tolstoy-Timestamp")
    webhookSecret := os.Getenv("TOLSTOY_WEBHOOK_SECRET")
    
    // Verify timestamp
    ts, _ := strconv.ParseInt(timestamp, 10, 64)
    currentTime := time.Now().Unix()
    if abs(currentTime - ts) > 300 {
        http.Error(w, "Request too old", 401)
        return
    }
    
    // Verify signature
    mac := hmac.New(sha256.New, []byte(webhookSecret))
    mac.Write([]byte(timestamp + "." + string(payload)))
    expectedSignature := hex.EncodeToString(mac.Sum(nil))
    
    providedSignature := signature[7:] // Remove "sha256=" prefix
    
    if !hmac.Equal([]byte(expectedSignature), []byte(providedSignature)) {
        http.Error(w, "Invalid signature", 401)
        return
    }
    
    // Process webhook
    var event map[string]interface{}
    json.Unmarshal(payload, &event)
    fmt.Printf("Received event: %s\n", event["type"])
    
    w.WriteHeader(200)
    w.Write([]byte("OK"))
}
```
</CodeGroup>

### IP Allowlisting

```bash
# Configure IP allowlist for webhook sources
tolstoy webhooks update webhook_abc123def456 \
  --allowed-ips "192.168.1.0/24,10.0.0.0/8" \
  --description "Restrict to internal networks only"

# View current IP restrictions
tolstoy webhooks get webhook_abc123def456 --show-security
```

## Webhook Monitoring and Debugging

### Delivery Logs and Statistics

```bash
# View recent webhook deliveries
tolstoy webhooks logs webhook_abc123def456 --limit 50

# Sample output:
📋 Webhook Delivery Logs: webhook_abc123def456

┌──────────────────────┬─────────────────────┬─────────────┬──────────┬─────────────┐
│ Delivery ID          │ Event Type          │ Status      │ Duration │ Timestamp   │
├──────────────────────┼─────────────────────┼─────────────┼──────────┼─────────────┤
│ delivery_abc123      │ flow.completed      │ ✅ Success │ 245ms    │ 2 mins ago  │
│ delivery_def456      │ action.failed       │ ❌ Failed  │ 30000ms  │ 5 mins ago  │  
│ delivery_ghi789      │ flow.started        │ ✅ Success │ 156ms    │ 8 mins ago  │
│ delivery_jkl012      │ flow.completed      │ 🔄 Retry   │ -        │ 10 mins ago │
└──────────────────────┴─────────────────────┴─────────────┴──────────┴─────────────┘

Recent Failures:
• delivery_def456: Connection timeout after 30s
• delivery_jkl012: HTTP 503 Service Unavailable (will retry)
```

### Delivery Statistics

```bash
# Get webhook delivery statistics
tolstoy webhooks stats webhook_abc123def456 --since 7d

# Sample output:
📊 Webhook Statistics: webhook_abc123def456 (Last 7 Days)

Delivery Summary:
┌─────────────────────┬─────────┬─────────────┬─────────────┐
│ Metric              │ Value   │ Success %   │ Trend       │
├─────────────────────┼─────────┼─────────────┼─────────────┤
│ Total Deliveries    │ 1,247   │ 96.8%       │ 📈 +12%    │
│ Successful          │ 1,207   │ -           │ 📈 +15%    │
│ Failed              │ 23      │ -           │ 📉 -8%     │
│ Retrying            │ 17      │ -           │ ➡️ Stable  │
└─────────────────────┴─────────┴─────────────┴─────────────┘

Response Time Distribution:
• < 100ms: 45% (561 deliveries)
• 100-500ms: 38% (474 deliveries)  
• 500ms-2s: 12% (150 deliveries)
• > 2s: 5% (62 deliveries)

Event Type Breakdown:
• flow.completed: 567 deliveries (96.5% success)
• flow.failed: 234 deliveries (98.1% success)
• action.failed: 156 deliveries (94.2% success)
• flow.started: 290 deliveries (99.3% success)
```

### Failed Delivery Management

```bash
# View failed deliveries with details
tolstoy webhooks logs webhook_abc123def456 \
  --status failed \
  --since 24h \
  --show-errors

# Retry specific failed delivery
tolstoy webhooks retry delivery_def456ghi789

# Bulk retry all failed deliveries from last hour
tolstoy webhooks retry webhook_abc123def456 \
  --failed-since 1h \
  --confirm

# Set up automatic retry policy
tolstoy webhooks update webhook_abc123def456 \
  --retry-attempts 5 \
  --retry-delay 2s \
  --retry-backoff exponential \
  --max-retry-delay 60s
```

## Advanced Webhook Features

### Webhook Templates

```bash
# Create reusable webhook template
tolstoy webhooks template create "production-monitoring" \
  --events "flow.failed,action.failed,system.alert" \
  --headers "X-Source=Tolstoy,X-Environment=Production" \
  --timeout 30s \
  --retry-attempts 5 \
  --condition 'event.data.severity == "high" OR event.data.tags contains "critical"'

# Create webhook from template
tolstoy webhooks create --template "production-monitoring" \
  --url "https://alerts.company.com/webhooks/tolstoy" \
  --description "Production alert webhook"

# List available templates
tolstoy webhooks template list
```

### Webhook Transformations

```bash
# Create webhook with payload transformation
tolstoy webhooks create \
  --url "https://api.example.com/webhooks/custom" \
  --events "flow.completed" \
  --transform '
    {
      "alert_type": "workflow_success",
      "workflow_name": event.data.flow_name,
      "execution_time": event.data.duration_ms,
      "user": event.data.user_id,
      "timestamp": event.timestamp,
      "custom_field": "production_completion"
    }
  ' \
  --description "Custom payload format webhook"
```

### Conditional Webhooks

```bash
# Create webhook with complex conditions
tolstoy webhooks create \
  --url "https://api.example.com/webhooks/business-critical" \
  --events "flow.failed,action.failed" \
  --condition '
    (
      event.data.tags contains "critical" OR
      event.data.tags contains "production" OR
      event.data.flow_name matches "payment-.*" OR
      event.data.flow_name matches "user-onboarding"
    ) AND
    event.data.user_id != "user_test_account"
  ' \
  --description "Business-critical failure notifications"
```

## Integration Examples

### Slack Integration

```bash
# Create Slack notification webhook
tolstoy webhooks create \
  --url "https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXXXXXX" \
  --events "flow.failed,action.failed" \
  --transform '
    {
      "text": "🚨 Workflow Failure Alert",
      "blocks": [
        {
          "type": "section",
          "text": {
            "type": "mrkdwn",
            "text": "*Workflow Failed:* " + event.data.flow_name + "\n*Duration:* " + (event.data.duration_ms / 1000) + "s\n*User:* " + event.data.user_id
          }
        }
      ]
    }
  ' \
  --headers "Content-Type=application/json"
```

### PagerDuty Integration

```bash
# Create PagerDuty incident webhook
tolstoy webhooks create \
  --url "https://events.pagerduty.com/v2/enqueue" \
  --events "flow.failed,system.alert" \
  --transform '
    {
      "routing_key": "YOUR_INTEGRATION_KEY",
      "event_action": "trigger",
      "payload": {
        "summary": "Tolstoy " + event.type + ": " + event.data.flow_name,
        "source": "tolstoy-automation",
        "severity": event.data.severity || "error",
        "component": event.data.flow_name,
        "custom_details": event.data
      }
    }
  ' \
  --headers "Content-Type=application/json"
```

### Custom Analytics Integration

```bash
# Create analytics tracking webhook
tolstoy webhooks create \
  --url "https://analytics.company.com/api/events" \
  --events "flow.completed,flow.failed" \
  --transform '
    {
      "event_name": "workflow_execution",
      "properties": {
        "workflow_id": event.data.flow_id,
        "workflow_name": event.data.flow_name,
        "status": event.data.status,
        "duration_seconds": event.data.duration_ms / 1000,
        "user_id": event.data.user_id,
        "environment": event.metadata.environment,
        "timestamp": event.timestamp
      }
    }
  ' \
  --headers "Authorization=Bearer $ANALYTICS_API_KEY,Content-Type=application/json"
```

## Webhook Development and Testing

### Local Development

```bash
# Use ngrok for local webhook testing
ngrok http 3000

# Create webhook pointing to ngrok URL
tolstoy webhooks create \
  --url "https://abcd1234.ngrok.io/webhooks/tolstoy" \
  --events "flow.completed" \
  --description "Local development webhook"

# Test with sample payload
tolstoy webhooks test webhook_local_123456
```

### Webhook Testing Tools

```bash
# Test webhook connectivity
tolstoy webhooks test webhook_abc123def456 --verbose

# Send test event
tolstoy webhooks send-test-event webhook_abc123def456 \
  --event-type "flow.completed" \
  --sample-data

# Validate webhook endpoint
tolstoy webhooks validate webhook_abc123def456 \
  --check-ssl \
  --check-response-time \
  --check-signature-handling
```

### Debugging Webhooks

```bash
# Enable webhook debugging
tolstoy webhooks debug webhook_abc123def456 --enable

# View debug logs
tolstoy webhooks debug webhook_abc123def456 --show-logs

# Capture webhook requests for inspection
tolstoy webhooks capture webhook_abc123def456 \
  --duration 5m \
  --save-to webhook-capture.json
```

## Best Practices

### Webhook Design Guidelines

1. **Idempotency**: Ensure webhook endpoints can handle duplicate deliveries
2. **Fast Response**: Return 200 status quickly, process asynchronously
3. **Signature Verification**: Always verify webhook signatures
4. **Timeout Handling**: Set appropriate timeout values
5. **Retry Logic**: Implement exponential backoff for retries

### Security Best Practices

1. **HTTPS Only**: Use HTTPS endpoints for webhook URLs
2. **IP Allowlisting**: Restrict webhook sources to known IPs
3. **Secret Management**: Use strong, unique webhook secrets
4. **Timestamp Validation**: Check request timestamps to prevent replay attacks
5. **Error Handling**: Don't expose sensitive information in error responses

### Performance Optimization

1. **Event Filtering**: Use specific event filters to reduce noise
2. **Batch Processing**: Process multiple events together when possible
3. **Async Processing**: Handle webhook processing asynchronously
4. **Monitoring**: Set up monitoring for webhook health and performance
5. **Caching**: Cache webhook configurations for better performance

## Troubleshooting

### Common Issues

<details>
<summary>**Webhook deliveries failing**</summary>

**Symptoms**: High failure rate in webhook delivery logs

**Solutions**:
```bash
# Check webhook endpoint health
tolstoy webhooks test webhook_abc123def456 --verbose

# Review error details
tolstoy webhooks logs webhook_abc123def456 --status failed --show-errors

# Verify SSL certificate
tolstoy webhooks validate webhook_abc123def456 --check-ssl

# Test from external source
curl -X POST webhook_url -H "Content-Type: application/json" -d '{"test": true}'
```
</details>

<details>
<summary>**Events not being received**</summary>

**Symptoms**: Expected events are not triggering webhooks

**Solutions**:
```bash
# Check event subscriptions
tolstoy webhooks events subscriptions webhook_abc123def456

# Verify event filters
tolstoy webhooks get webhook_abc123def456 --show-filters

# Test event delivery
tolstoy webhooks send-test-event webhook_abc123def456 --event-type flow.completed

# Check webhook status
tolstoy webhooks get webhook_abc123def456 --show-status
```
</details>

<details>
<summary>**Signature verification failures**</summary>

**Symptoms**: Webhook endpoint receiving requests but signature validation fails

**Solutions**:
```bash
# Verify webhook secret
tolstoy webhooks get webhook_abc123def456 --show-secret

# Test signature generation
tolstoy webhooks test-signature webhook_abc123def456 --payload '{"test": true}'

# Check webhook headers
tolstoy webhooks capture webhook_abc123def456 --duration 1m

# Validate endpoint signature handling
tolstoy webhooks validate webhook_abc123def456 --check-signature-handling
```
</details>

## Next Steps

<CardGroup cols={2}>
  <Card title="Event Integration" icon="bolt" href="/cli/guides/webhook-integration">
    Learn to integrate webhooks with external systems
  </Card>
  <Card title="Security Configuration" icon="shield" href="/cli/guides/webhook-security">
    Implement secure webhook authentication and validation
  </Card>
</CardGroup>

<CardGroup cols={2}>
  <Card title="Monitoring Setup" icon="chart-line" href="/cli/guides/webhook-monitoring">
    Set up comprehensive webhook monitoring and alerting
  </Card>
  <Card title="Advanced Patterns" icon="code" href="/cli/guides/webhook-patterns">
    Learn advanced webhook patterns and transformations
  </Card>
</CardGroup>

---

*Webhooks enable real-time integration with external systems. Master these commands to build reliable, secure event-driven integrations.*