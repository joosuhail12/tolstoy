---
title: "Building Your First Workflow"
description: "Step-by-step guide to creating a complete workflow from start to finish"
---

# Building Your First Workflow

This guide will walk you through creating a complete workflow that demonstrates key Tolstoy concepts. We'll build an automated GitHub issue management system that processes new issues, validates them, and notifies the team.

## What We'll Build

Our workflow will:
1. **Trigger** when a new GitHub issue is created
2. **Validate** the issue has required information
3. **Classify** the issue type (bug, feature, etc.)
4. **Assign** the issue to the appropriate team member
5. **Notify** the team via Slack
6. **Update** a project management system

## Prerequisites

- Tolstoy account with organization access
- GitHub repository with admin access
- Slack workspace with bot permissions
- Basic understanding of YAML/JSON

## Step 1: Define the Flow Structure

Create a new file called `issue-management.yaml`:

```yaml issue-management.yaml
version: 1
name: "GitHub Issue Management"
description: "Automated issue processing and team notification"
metadata:
  tags: ["github", "automation", "notifications"]
  author: "engineering-team"

# Global variables for the workflow
variables:
  slack_channel: "#dev-notifications"
  default_assignee: "team-lead"
  project_id: "PROJ-123"
  
# Trigger configuration
triggers:
  - type: "webhook"
    name: "github-issues"
    events: ["issues.opened"]
    source: "github"

steps:
  # Step 1: Validate issue
  - key: "validate-issue"
    name: "Validate Issue Requirements"
    action: "github.validate-issue"
    inputs:
      issue_id: "{{trigger.payload.issue.id}}"
      required_fields: ["title", "body"]
      min_title_length: 10
      min_body_length: 50
    
  # Step 2: Extract issue details  
  - key: "extract-details"
    name: "Extract Issue Information"
    action: "data.transform"
    inputs:
      data: "{{trigger.payload.issue}}"
      template: |
        {
          "id": "{{data.id}}",
          "title": "{{data.title}}",
          "body": "{{data.body}}",
          "author": "{{data.user.login}}",
          "labels": "{{data.labels}}",
          "url": "{{data.html_url}}",
          "repository": "{{data.repository.name}}"
        }
    dependsOn: ["validate-issue"]
    
  # Step 3: Classify the issue
  - key: "classify-issue"
    name: "Classify Issue Type"
    action: "ai.classify-text"
    inputs:
      text: "{{steps.extract-details.output.title}} {{steps.extract-details.output.body}}"
      categories: ["bug", "feature", "documentation", "question", "enhancement"]
      confidence_threshold: 0.8
    dependsOn: ["extract-details"]
    
  # Step 4: Determine assignee
  - key: "assign-owner"
    name: "Determine Issue Owner"
    action: "github.assign-by-expertise"
    inputs:
      issue_type: "{{steps.classify-issue.output.category}}"
      repository: "{{steps.extract-details.output.repository}}"
      team_mapping:
        bug: "backend-team"
        feature: "product-team"
        documentation: "docs-team"
        question: "support-team"
        enhancement: "frontend-team"
      fallback_assignee: "{{variables.default_assignee}}"
    dependsOn: ["classify-issue"]
    
  # Step 5: Update GitHub issue
  - key: "update-issue"
    name: "Update Issue with Classification"
    action: "github.update-issue"
    inputs:
      issue_id: "{{steps.extract-details.output.id}}"
      labels: 
        - "{{steps.classify-issue.output.category}}"
        - "automated"
      assignees: ["{{steps.assign-owner.output.assignee}}"]
      comment: |
        🤖 **Automated Processing Complete**
        
        **Classification:** {{steps.classify-issue.output.category}}
        **Confidence:** {{steps.classify-issue.output.confidence}}%
        **Assigned to:** @{{steps.assign-owner.output.assignee}}
        
        This issue has been automatically processed and assigned based on its content.
    dependsOn: ["assign-owner"]
    
  # Step 6: Notify team via Slack
  - key: "slack-notification"
    name: "Send Slack Notification"
    action: "slack.send-message"
    inputs:
      channel: "{{variables.slack_channel}}"
      message: |
        🆕 **New Issue Assigned**
        
        **Title:** {{steps.extract-details.output.title}}
        **Type:** {{steps.classify-issue.output.category}}
        **Assigned to:** @{{steps.assign-owner.output.assignee}}
        **Author:** {{steps.extract-details.output.author}}
        
        {{steps.extract-details.output.url}}
      blocks:
        - type: "section"
          text:
            type: "mrkdwn"
            text: "*Priority:* {{steps.classify-issue.output.priority || 'Normal'}}"
        - type: "actions"
          elements:
            - type: "button"
              text:
                type: "plain_text"
                text: "View Issue"
              url: "{{steps.extract-details.output.url}}"
              style: "primary"
    dependsOn: ["update-issue"]
    executeIf:
      operator: "not_equals"
      field: "steps.classify-issue.output.category"
      value: "spam"
      
  # Step 7: Update project management
  - key: "update-project"
    name: "Create Project Ticket"
    action: "jira.create-issue"
    inputs:
      project: "{{variables.project_id}}"
      issue_type: "{{steps.classify-issue.output.category === 'bug' ? 'Bug' : 'Task'}}"
      summary: "[GitHub] {{steps.extract-details.output.title}}"
      description: |
        Imported from GitHub Issue: {{steps.extract-details.output.url}}
        
        **Original Author:** {{steps.extract-details.output.author}}
        **Repository:** {{steps.extract-details.output.repository}}
        **Classification:** {{steps.classify-issue.output.category}}
        
        **Description:**
        {{steps.extract-details.output.body}}
      assignee: "{{steps.assign-owner.output.assignee}}"
      priority: "{{steps.classify-issue.output.priority}}"
      labels: ["github", "automated", "{{steps.classify-issue.output.category}}"]
    dependsOn: ["slack-notification"]
    executeIf:
      operator: "in"
      field: "steps.classify-issue.output.category"
      value: ["bug", "feature", "enhancement"]

# Error handling configuration
errorHandling:
  strategy: "retry"
  maxRetries: 2
  backoff: "exponential"
  onError:
    - action: "slack.send-message"
      inputs:
        channel: "{{variables.slack_channel}}"
        message: |
          ⚠️ **Workflow Failed**
          
          Issue processing failed for: {{steps.extract-details.output.title || 'Unknown Issue'}}
          Error: {{error.message}}
          
          Please review manually: {{steps.extract-details.output.url || trigger.payload.issue.html_url}}

# Monitoring and observability
monitoring:
  metrics:
    - name: "issues_processed"
      type: "counter"
      labels: ["repository", "issue_type", "assignee"]
    - name: "processing_duration"
      type: "histogram"
      labels: ["issue_type"]
  alerts:
    - name: "high_failure_rate"
      condition: "failure_rate > 0.1"
      notification: "slack"
      channel: "#alerts"
```

## Step 2: Configure Actions

Before deploying, we need to ensure all required actions are available:

### GitHub Actions
```bash
# Install GitHub integration
tolstoy install github

# Configure GitHub credentials
tolstoy config set github.token $GITHUB_TOKEN
tolstoy config set github.webhook_secret $WEBHOOK_SECRET
```

### Slack Actions
```bash
# Install Slack integration  
tolstoy install slack

# Configure Slack credentials
tolstoy config set slack.bot_token $SLACK_BOT_TOKEN
tolstoy config set slack.app_token $SLACK_APP_TOKEN
```

### AI Classification
```bash
# Install AI/ML actions
tolstoy install ai-tools

# Configure AI service
tolstoy config set ai.provider openai
tolstoy config set ai.api_key $OPENAI_API_KEY
```

## Step 3: Test the Workflow

### Validate Configuration
```bash
# Validate the flow definition
tolstoy validate issue-management.yaml

# Check for any configuration issues
tolstoy doctor --flow issue-management
```

### Run Tests
```bash
# Run with test data
tolstoy test issue-management.yaml --data test-issue.json

# Dry run mode (no side effects)
tolstoy run issue-management --dry-run --trigger-data test-issue.json
```

### Test Data Example
Create `test-issue.json`:
```json
{
  "trigger": {
    "payload": {
      "issue": {
        "id": 123456,
        "title": "Bug: Application crashes on startup",
        "body": "When launching the application, it immediately crashes with a null pointer exception. This happens consistently across different environments.",
        "user": {
          "login": "developer123"
        },
        "html_url": "https://github.com/company/repo/issues/123",
        "repository": {
          "name": "main-app"
        },
        "labels": []
      }
    }
  }
}
```

## Step 4: Deploy and Monitor

### Deploy the Workflow
```bash
# Deploy to staging first
tolstoy deploy issue-management.yaml --environment staging

# Deploy to production
tolstoy deploy issue-management.yaml --environment production

# Enable the workflow
tolstoy enable issue-management
```

### Set Up Monitoring
```bash
# View workflow status
tolstoy status issue-management

# Monitor executions in real-time
tolstoy logs issue-management --follow

# View metrics dashboard
tolstoy dashboard issue-management
```

## Step 5: Advanced Customization

### Custom Classification Logic
You can replace the AI classification with custom logic:

```yaml
- key: "classify-issue"
  name: "Custom Issue Classification"
  action: "control.if"
  inputs:
    condition:
      operator: "or"
      conditions:
        - operator: "contains"
          field: "steps.extract-details.output.title"
          value: "bug"
        - operator: "contains"
          field: "steps.extract-details.output.body"
          value: "error"
    then:
      - action: "data.set"
        inputs:
          category: "bug"
          priority: "high"
    else:
      - action: "data.set"
        inputs:
          category: "feature"
          priority: "medium"
```

### Dynamic Team Assignment
Create more sophisticated assignment logic:

```yaml
- key: "assign-owner"
  name: "Smart Team Assignment"
  action: "custom.team-assignment"
  inputs:
    issue_data: "{{steps.extract-details.output}}"
    classification: "{{steps.classify-issue.output}}"
    team_workload: true  # Consider current workload
    expertise_matching: true  # Match based on expertise
    time_zone_preference: true  # Consider time zones
```

## Step 6: Integration Testing

### End-to-End Testing
```bash
# Create a test issue in GitHub
curl -X POST \
  -H "Authorization: token $GITHUB_TOKEN" \
  -H "Accept: application/vnd.github.v3+json" \
  https://api.github.com/repos/your-org/your-repo/issues \
  -d '{
    "title": "Test Issue for Automation",
    "body": "This is a test issue to verify the automated workflow is working correctly."
  }'

# Monitor the workflow execution
tolstoy logs issue-management --execution-id latest
```

### Monitoring Results
Check that all steps completed successfully:
1. ✅ Issue was validated
2. ✅ Details were extracted
3. ✅ Issue was classified
4. ✅ Owner was assigned
5. ✅ GitHub issue was updated
6. ✅ Slack notification was sent
7. ✅ Project ticket was created

## Troubleshooting

<AccordionGroup>
  <Accordion title="Workflow Not Triggering">
    Check webhook configuration:
    ```bash
    # Verify webhook is active
    tolstoy webhook status github-issues
    
    # Check webhook events
    tolstoy webhook logs github-issues
    
    # Re-register webhook if needed
    tolstoy webhook register github-issues --force
    ```
  </Accordion>

  <Accordion title="Step Failures">
    Common issues and solutions:
    ```bash
    # Check step-specific logs
    tolstoy logs issue-management --step validate-issue
    
    # Verify action configuration
    tolstoy action test github.validate-issue
    
    # Check credentials
    tolstoy config verify github.token
    ```
  </Accordion>

  <Accordion title="Performance Issues">
    Optimize workflow performance:
    ```bash
    # Check execution times
    tolstoy metrics issue-management --metric processing_duration
    
    # Enable parallel execution where possible
    # Remove unnecessary dependencies between steps
    
    # Use step-level timeouts
    timeout: 10000  # 10 seconds per step
    ```
  </Accordion>
</AccordionGroup>

## Next Steps

Congratulations! You've built a comprehensive workflow. Here are some ways to expand it:

<CardGroup cols={2}>
  <Card title="Add More Integrations" icon="plus">
    Connect additional tools like Linear, Notion, or custom APIs
  </Card>
  <Card title="Implement Analytics" icon="chart-bar">
    Add detailed tracking and reporting capabilities
  </Card>
  <Card title="Create Variations" icon="clone">
    Build similar workflows for pull requests, deployments, etc.
  </Card>
  <Card title="Advanced Features" icon="cog">
    Explore loops, conditions, and complex data transformations
  </Card>
</CardGroup>

## Community Examples

Browse more workflow examples:
- **[CI/CD Pipelines](https://github.com/tolstoy-dev/examples/tree/main/cicd)**
- **[Data Processing](https://github.com/tolstoy-dev/examples/tree/main/data)**
- **[Customer Support](https://github.com/tolstoy-dev/examples/tree/main/support)**
- **[E-commerce Automation](https://github.com/tolstoy-dev/examples/tree/main/ecommerce)**

Ready to build more complex workflows? Check out our [Advanced Patterns Guide](/advanced/patterns) next!