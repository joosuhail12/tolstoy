---
title: Action Execution
sidebar_position: 4
---

# Action Execution

Execute individual workflow actions using the Tolstoy CLI. Perfect for testing, debugging, and integrating actions into scripts and automation workflows.

## Overview

The `actions:execute` command runs a single action with provided inputs and returns the results. Actions can be executed with organization-level or user-scoped authentication.

## Basic Usage

```bash
tolstoy actions:execute [OPTIONS] <inputs>
```

## Required Options

| Option | Description | Example |
|--------|-------------|---------|
| `-o, --org <orgId>` | Organization ID | `-o my-org-123` |
| `-k, --key <actionKey>` | Action key/identifier | `-k create-issue` |
| `<inputs>` | JSON string of action inputs | `'{"title": "Bug report"}'` |

## Optional Options

| Option | Description | Default |
|--------|-------------|---------|
| `-u, --user <userId>` | User ID for user-scoped auth | None |
| `--timeout <seconds>` | Request timeout | `30` |
| `--json` | Output in JSON format | Human-readable |

## Examples

### Basic Action Execution
```bash
tolstoy actions:execute \
  --org my-org \
  --key send-email \
  '{"to": "user@example.com", "subject": "Welcome!", "body": "Hello World"}'
```

Output:
```
ðŸš€ Executing action "send-email"...
Organization: my-org
Action Key: send-email
Inputs: {"to": "user@example.com", "subject": "Welcome!", "body": "Hello World"}

âœ… Action executed successfully
Success: true
Execution ID: exec-12345
Duration: 1250ms

Result Data:
{
  "messageId": "msg-98765",
  "status": "sent",
  "timestamp": "2024-01-15T10:30:00Z"
}

Full Result:
{
  "success": true,
  "executionId": "exec-12345",
  "duration": 1250,
  "data": {
    "messageId": "msg-98765", 
    "status": "sent",
    "timestamp": "2024-01-15T10:30:00Z"
  }
}
```

### User-Scoped Execution
```bash
tolstoy actions:execute \
  --org my-org \
  --key github-create-issue \
  --user user-123 \
  '{"title": "Bug in login flow", "body": "Users cannot log in", "labels": ["bug", "urgent"]}'
```

Output:
```
ðŸš€ Executing action "github-create-issue"...
Organization: my-org
Action Key: github-create-issue
User ID: user-123
Inputs: {"title": "Bug in login flow", "body": "Users cannot log in", "labels": ["bug", "urgent"]}

âœ… Action executed successfully
Success: true
Execution ID: exec-67890
Duration: 2100ms

Result Data:
{
  "issue_number": 42,
  "url": "https://github.com/myorg/repo/issues/42",
  "state": "open"
}
```

### JSON Output Format
```bash
tolstoy actions:execute \
  --org my-org \
  --key fetch-user-data \
  --json \
  '{"user_id": "12345"}'
```

Output:
```json
{
  "success": true,
  "executionId": "exec-11111",
  "duration": 850,
  "data": {
    "user": {
      "id": "12345",
      "name": "John Doe", 
      "email": "john@example.com"
    },
    "preferences": {
      "theme": "dark",
      "notifications": true
    }
  }
}
```

### Custom Timeout
```bash
tolstoy actions:execute \
  --org my-org \
  --key slow-data-processing \
  --timeout 120 \
  '{"dataset": "large_dataset.csv", "operations": ["transform", "validate", "export"]}'
```

## Input Formats

### Simple JSON
```bash
tolstoy actions:execute -o my-org -k simple-action '{"name": "test", "count": 5}'
```

### Complex Nested Data
```bash
tolstoy actions:execute -o my-org -k complex-action '{
  "user": {
    "name": "John Doe",
    "email": "john@example.com",
    "preferences": {
      "notifications": true,
      "theme": "dark"
    }
  },
  "settings": {
    "auto_save": true,
    "timeout": 30
  }
}'
```

### Arrays
```bash
tolstoy actions:execute -o my-org -k batch-process '{
  "items": [
    {"id": 1, "name": "Item 1"},
    {"id": 2, "name": "Item 2"},
    {"id": 3, "name": "Item 3"}
  ],
  "operation": "update"
}'
```

### Environment Variables in JSON
```bash
export USER_EMAIL="john@example.com"
export USER_ID="12345"

tolstoy actions:execute -o my-org -k user-action "{
  \"email\": \"$USER_EMAIL\",
  \"user_id\": \"$USER_ID\",
  \"timestamp\": \"$(date -u +%Y-%m-%dT%H:%M:%SZ)\"
}"
```

## Authentication Patterns

### Organization-Level Actions
Actions that use tool credentials configured at the organization level:

```bash
# Uses organization's GitHub API key/OAuth2 client
tolstoy actions:execute \
  --org my-org \
  --key github-list-repos \
  '{}'
```

### User-Scoped Actions  
Actions that require user-specific authentication (user must have completed OAuth login):

```bash
# Uses specific user's GitHub OAuth tokens
tolstoy actions:execute \
  --org my-org \
  --key github-create-issue \
  --user user-123 \
  '{"title": "User-specific issue", "assignee": "@user-123"}'
```

## Common Use Cases

### 1. CI/CD Integration

Deploy applications and notify teams:

```bash
#!/bin/bash
DEPLOY_RESULT=$(tolstoy actions:execute \
  --org production \
  --key deploy-application \
  --json \
  '{"version": "'$GITHUB_REF_NAME'", "environment": "production"}')

if [[ $(echo $DEPLOY_RESULT | jq -r '.success') == "true" ]]; then
  tolstoy actions:execute \
    --org production \
    --key slack-notify \
    '{"channel": "#deployments", "message": "ðŸš€ Successfully deployed '$GITHUB_REF_NAME' to production"}'
else
  tolstoy actions:execute \
    --org production \
    --key slack-notify \
    '{"channel": "#alerts", "message": "âŒ Deployment failed for '$GITHUB_REF_NAME'"}'
fi
```

### 2. Data Processing Scripts

Process data and handle results:

```bash
#!/bin/bash

# Process customer data
echo "Processing customer export..."
RESULT=$(tolstoy actions:execute \
  --org data-team \
  --key export-customer-data \
  --timeout 300 \
  --json \
  '{"date_range": "last_30_days", "format": "csv"}')

EXPORT_URL=$(echo $RESULT | jq -r '.data.download_url')
RECORD_COUNT=$(echo $RESULT | jq -r '.data.record_count')

echo "Export completed: $RECORD_COUNT records"
echo "Download URL: $EXPORT_URL"

# Send notification with results
tolstoy actions:execute \
  --org data-team \
  --key email-notification \
  '{
    "to": "data-team@company.com",
    "subject": "Customer Data Export Complete",
    "body": "Export completed with '$RECORD_COUNT' records. Download: '$EXPORT_URL'"
  }'
```

### 3. User Interaction Workflows

Handle user-specific actions:

```bash
#!/bin/bash

USER_ID="user-123"
ACTION_TYPE="purchase_completed"

# Log user action
tolstoy actions:execute \
  --org analytics \
  --key track-user-event \
  --user $USER_ID \
  '{
    "event": "'$ACTION_TYPE'",
    "properties": {
      "amount": 99.99,
      "product": "premium_plan",
      "currency": "USD"
    }
  }'

# Update user profile
tolstoy actions:execute \
  --org user-service \
  --key update-user-profile \
  --user $USER_ID \
  '{
    "plan": "premium",
    "upgraded_at": "'$(date -u +%Y-%m-%dT%H:%M:%SZ)'"
  }'

# Send welcome email
tolstoy actions:execute \
  --org marketing \
  --key send-template-email \
  --user $USER_ID \
  '{
    "template": "premium_welcome",
    "personalization": {
      "first_name": "John",
      "plan_features": ["unlimited_projects", "priority_support", "advanced_analytics"]
    }
  }'
```

## Error Handling

### JSON Validation Errors
```bash
$ tolstoy actions:execute -o my-org -k test-action '{invalid: json}'
Error: Invalid JSON inputs provided
Example: '{"key": "value", "number": 123}'
```

### Action Not Found
```bash
$ tolstoy actions:execute -o my-org -k nonexistent-action '{}'
Error: 404 Not Found
Details: Action not found
```

### Timeout Errors
```bash
$ tolstoy actions:execute -o my-org -k slow-action --timeout 10 '{}'
Error executing action: Request timeout
Hint: Action execution timed out after 10 seconds. Use --timeout to increase.
```

### Authentication Errors
```bash
$ tolstoy actions:execute -o my-org -k github-action --user user-123 '{}'
Error: 401 Unauthorized
Details: User user-123 has not authorized GitHub access
```

### Input Validation Errors
```bash
$ tolstoy actions:execute -o my-org -k email-action '{"to": "invalid-email"}'
Error: 400 Bad Request
Details: Invalid email address format
```

## Scripting Best Practices

### 1. Error Handling
```bash
#!/bin/bash

execute_action() {
  local org=$1
  local action=$2
  local inputs=$3
  
  local result
  result=$(tolstoy actions:execute \
    --org "$org" \
    --key "$action" \
    --json \
    "$inputs" 2>&1)
    
  if [[ $? -eq 0 ]]; then
    echo "Success: $result"
    return 0
  else
    echo "Error: $result" >&2
    return 1
  fi
}

# Usage
if execute_action "my-org" "send-email" '{"to": "user@example.com", "subject": "Test"}'; then
  echo "Email sent successfully"
else
  echo "Failed to send email"
  exit 1
fi
```

### 2. JSON Templating
```bash
#!/bin/bash

create_issue_json() {
  local title=$1
  local body=$2
  local assignee=$3
  
  jq -n \
    --arg title "$title" \
    --arg body "$body" \
    --arg assignee "$assignee" \
    '{
      title: $title,
      body: $body,
      assignee: $assignee,
      labels: ["automation", "cli"]
    }'
}

# Usage
ISSUE_JSON=$(create_issue_json "Bug Report" "Found a critical bug" "john-doe")
tolstoy actions:execute --org my-org --key github-create-issue --json "$ISSUE_JSON"
```

### 3. Result Processing
```bash
#!/bin/bash

# Execute action and process results
RESULT=$(tolstoy actions:execute \
  --org my-org \
  --key data-analysis \
  --json \
  '{"dataset": "sales_data", "period": "Q1_2024"}')

# Extract specific fields
SUCCESS=$(echo "$RESULT" | jq -r '.success')
EXECUTION_ID=$(echo "$RESULT" | jq -r '.executionId')
RECORDS_PROCESSED=$(echo "$RESULT" | jq -r '.data.records_processed')
INSIGHTS=$(echo "$RESULT" | jq -r '.data.insights[]')

if [[ "$SUCCESS" == "true" ]]; then
  echo "Analysis completed successfully (ID: $EXECUTION_ID)"
  echo "Processed $RECORDS_PROCESSED records"
  echo "Key insights:"
  echo "$INSIGHTS" | while read -r insight; do
    echo "  - $insight"
  done
else
  echo "Analysis failed"
  exit 1
fi
```

## Environment Variables

Set up your environment for consistent usage:

```bash
# ~/.bashrc or ~/.zshrc
export TOLSTOY_API_URL="https://api.tolstoy.com"
export TOLSTOY_API_KEY="your-api-key"
export ORG_ID="your-default-org"

# Optional: Create aliases for common actions
alias tolstoy-email='tolstoy actions:execute --org $ORG_ID --key send-email'
alias tolstoy-github='tolstoy actions:execute --org $ORG_ID --key github-create-issue'

# Usage with aliases
tolstoy-email '{"to": "user@example.com", "subject": "Hello"}'
tolstoy-github --user user-123 '{"title": "Bug report", "body": "Details here"}'
```

## Testing and Debugging

### 1. Dry Run Testing
Test your JSON inputs before executing:

```bash
# Validate JSON syntax
echo '{"title": "test", "count": 5}' | jq .

# Preview the exact command
echo "tolstoy actions:execute --org my-org --key test-action '$(echo '{"title": "test"}' | jq -c .)'"
```

### 2. Debug Output
Use verbose output to troubleshoot:

```bash
# Normal output shows full result
tolstoy actions:execute --org my-org --key debug-action '{"debug": true}'

# JSON output for programmatic processing
tolstoy actions:execute --org my-org --key debug-action --json '{"debug": true}' | jq .
```

## Next Steps

After mastering action execution:

1. **Build automation scripts**: Combine multiple actions into workflows
2. **Set up monitoring**: Track action success/failure rates
3. **Implement error handling**: Create robust error recovery mechanisms
4. **Optimize performance**: Use appropriate timeouts and parallel execution

## Related Commands

- [`tool auth api-key`](./tool-auth.mdx) - Configure API key authentication for actions
- [`tool auth oauth2`](./tool-auth.mdx) - Configure OAuth2 for user-scoped actions  
- [`auth login`](./authentication.mdx) - Set up user authentication for actions