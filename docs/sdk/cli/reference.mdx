---
title: Command Reference
sidebar_position: 5
---

# CLI Command Reference

Complete reference for all Tolstoy CLI commands, options, and usage patterns.

## Global Options

Available for all commands:

| Option | Description | Example |
|--------|-------------|---------|
| `--api-url <url>` | Override API base URL | `--api-url https://api.tolstoy.com` |
| `--api-key <key>` | Override API key | `--api-key your-api-key` |
| `--json` | Output in JSON format | `--json` |
| `--help` | Show command help | `--help` |
| `--version` | Show CLI version | `--version` |

## Environment Variables

| Variable | Description | Required |
|----------|-------------|----------|
| `TOLSTOY_API_URL` | API base URL | Yes |
| `TOLSTOY_API_KEY` | API authentication key | Yes |
| `ORG_ID` | Default organization ID | No |

## Commands

### `tool auth api-key`

Configure API key authentication for a tool.

**Usage:**
```bash
tolstoy tool auth api-key [OPTIONS]
```

**Required Options:**
- `-o, --org <orgId>` - Organization ID
- `-t, --tool <toolKey>` - Tool key/identifier
- `-k, --key <apiKey>` - API key value

**Optional Options:**
- `-h, --header <headerName>` - Header name (default: "Authorization")

**Examples:**
```bash
# GitHub API key
tolstoy tool auth api-key -o my-org -t github -k ghp_xxxxxxxxxxxx

# Custom header
tolstoy tool auth api-key -o my-org -t api-service -k secret123 -h "X-API-Key"
```

**Exit Codes:**
- `0` - Success
- `1` - Error (network, validation, etc.)

---

### `tool auth oauth2`

Configure OAuth2 client credentials for a tool.

**Usage:**
```bash
tolstoy tool auth oauth2 [OPTIONS]
```

**Required Options:**
- `-o, --org <orgId>` - Organization ID
- `-t, --tool <toolKey>` - Tool key/identifier  
- `-i, --client-id <clientId>` - OAuth2 client ID
- `-s, --client-secret <secret>` - OAuth2 client secret
- `-c, --callback-url <url>` - OAuth2 callback/redirect URL

**Optional Options:**
- `--scope <scope>` - OAuth2 scope (space-separated)
- `--authorize-url <url>` - Custom authorization URL
- `--token-url <url>` - Custom token exchange URL

**Examples:**
```bash
# Google OAuth2
tolstoy tool auth oauth2 \
  -o my-org \
  -t google \
  -i 123456.apps.googleusercontent.com \
  -s GOCSPX-xxxxxxxxxxxx \
  -c "https://app.com/callback" \
  --scope "https://www.googleapis.com/auth/drive"

# GitHub OAuth App
tolstoy tool auth oauth2 \
  -o my-org \
  -t github \
  -i Iv1.xxxxxxxxxxxx \
  -s xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx \
  -c "https://app.com/auth/callback" \
  --scope "repo user"
```

**Exit Codes:**
- `0` - Success
- `1` - Error (network, validation, etc.)

---

### `auth login`

Perform user OAuth2 login for a tool.

**Usage:**
```bash
tolstoy auth login [OPTIONS]
```

**Required Options:**
- `-t, --tool <toolKey>` - Tool key/identifier
- `-u, --user <userId>` - User ID to associate with tokens

**Optional Options:**
- `-o, --org <orgId>` - Organization ID (uses `ORG_ID` env var if not provided)
- `--no-open` - Display URL instead of opening browser

**Examples:**
```bash
# GitHub login (opens browser)
tolstoy auth login -t github -u user-123 -o my-org

# Manual URL (no browser)
tolstoy auth login -t google -u user-456 --no-open
```

**Exit Codes:**
- `0` - Success (login URL generated/opened)
- `1` - Error (missing config, network, etc.)

---

### `actions:execute`

Execute a single Action by key.

**Usage:**
```bash
tolstoy actions:execute [OPTIONS] <inputs>
```

**Required Options:**
- `-o, --org <orgId>` - Organization ID
- `-k, --key <actionKey>` - Action key/identifier
- `<inputs>` - JSON string of inputs

**Optional Options:**
- `-u, --user <userId>` - User ID for user-scoped authentication
- `--timeout <seconds>` - Request timeout in seconds (default: 30)
- `--json` - Output result in JSON format

**Examples:**
```bash
# Basic execution
tolstoy actions:execute -o my-org -k send-email '{"to": "user@example.com", "subject": "Hello"}'

# User-scoped with timeout
tolstoy actions:execute -o my-org -k github-action -u user-123 --timeout 60 '{"repo": "myrepo"}'

# JSON output
tolstoy actions:execute -o my-org -k data-fetch --json '{"query": "users"}'
```

**Exit Codes:**
- `0` - Action executed successfully
- `1` - Error (network, validation, action failure, etc.)

---

### `templates list`

List available flow templates.

**Usage:**
```bash
tolstoy templates list [OPTIONS]
```

**Options:**
- `-c, --category <category>` - Filter by category
- `-t, --tag <tag>` - Filter by tag
- `--verbose` - Show detailed information

**Examples:**
```bash
# List all templates
tolstoy templates list

# Filter by category
tolstoy templates list -c integration

# Verbose output
tolstoy templates list --verbose
```

---

### `templates show`

Show detailed information about a template.

**Usage:**
```bash
tolstoy templates show <name>
```

**Examples:**
```bash
# Show template details
tolstoy templates show github-webhook-notify
```

---

### `templates import`

Import a flow template into your organization.

**Usage:**
```bash
tolstoy templates import <name> [OPTIONS]
```

**Options:**
- `-o, --org <orgId>` - Organization ID
- `--flow-name <name>` - Custom name for imported flow
- `--dry-run` - Show what would be imported
- `-y, --yes` - Skip confirmation prompts

**Examples:**
```bash
# Import template
tolstoy templates import github-webhook-notify -o my-org

# Dry run
tolstoy templates import email-automation --dry-run

# Custom name
tolstoy templates import data-pipeline --flow-name "Daily ETL Process"
```

---

### `orgs`

List organizations.

**Usage:**
```bash
tolstoy orgs
```

**Examples:**
```bash
# List all organizations
tolstoy orgs

# JSON output  
tolstoy orgs --json
```

---

### `auth`

Test authentication and connection to Tolstoy API.

**Usage:**
```bash
tolstoy auth
```

**Examples:**
```bash
# Test connection
tolstoy auth

# JSON output
tolstoy auth --json
```

## Input Formats

### JSON Inputs for Actions

The `actions:execute` command requires JSON inputs. Here are formatting guidelines:

**Simple Objects:**
```bash
'{"key": "value", "number": 123, "boolean": true}'
```

**Nested Objects:**
```bash
'{
  "user": {
    "name": "John Doe",
    "email": "john@example.com"
  },
  "settings": {
    "notifications": true
  }
}'
```

**Arrays:**
```bash
'{
  "items": [
    {"id": 1, "name": "Item 1"},
    {"id": 2, "name": "Item 2"}
  ]
}'
```

**Shell Variables:**
```bash
USER_EMAIL="john@example.com"
tolstoy actions:execute -o my-org -k action "{\"email\": \"$USER_EMAIL\"}"
```

## Output Formats

### Default (Human-Readable)
```
ðŸš€ Executing action "send-email"...
âœ… Action executed successfully
Success: true
Execution ID: exec-123
Duration: 1500ms
```

### JSON Output (`--json`)
```json
{
  "success": true,
  "executionId": "exec-123",
  "duration": 1500,
  "data": { "messageId": "msg-456" }
}
```

## Exit Codes

All commands use standard exit codes:

| Code | Meaning |
|------|---------|
| `0` | Success |
| `1` | General error |
| `2` | Misuse of shell command |
| `126` | Command invoked cannot execute |
| `127` | Command not found |

## Error Messages

Common error patterns and solutions:

### Environment Errors
```
Error: API_BASE_URL or TOLSTOY_API_URL environment variable not set
```
**Solution:** Set required environment variables.

### Authentication Errors  
```
Error: 401 Unauthorized
Details: Invalid API key
```
**Solution:** Check `TOLSTOY_API_KEY` value.

### Network Errors
```
Error: ECONNREFUSED
Hint: Make sure the Tolstoy API is running and accessible
```
**Solution:** Verify API URL and network connectivity.

### Validation Errors
```
Error: Invalid JSON inputs provided
Example: '{"key": "value", "number": 123}'
```
**Solution:** Fix JSON syntax errors.

### Timeout Errors
```
Error: Request timeout after 30 seconds
Hint: Use --timeout to increase limit
```
**Solution:** Use `--timeout <seconds>` for longer operations.

## Shell Integration

### Bash Completion
Add to `~/.bashrc`:
```bash
eval "$(tolstoy --completion bash)"
```

### Zsh Completion  
Add to `~/.zshrc`:
```zsh
eval "$(tolstoy --completion zsh)"
```

### Aliases
Create shortcuts for common commands:
```bash
# ~/.bashrc or ~/.zshrc
alias tol='tolstoy'
alias tol-exec='tolstoy actions:execute'
alias tol-auth='tolstoy tool auth'

# Usage
tol-exec -o my-org -k send-email '{"to": "user@example.com"}'
```

## Configuration Files

### Project Configuration
Create `.tolstoyrc` in project root:
```json
{
  "apiUrl": "https://api.tolstoy.com",
  "defaultOrg": "my-org-123",
  "timeout": 30
}
```

### Global Configuration  
Create `~/.config/tolstoy/config.json`:
```json
{
  "profiles": {
    "development": {
      "apiUrl": "https://dev-api.tolstoy.com",
      "org": "dev-org"  
    },
    "production": {
      "apiUrl": "https://api.tolstoy.com",
      "org": "prod-org"
    }
  },
  "defaultProfile": "development"
}
```

## Debugging

### Verbose Output
Set debug environment variable:
```bash
export DEBUG=tolstoy:*
tolstoy actions:execute -o my-org -k debug-action '{}'
```

### Network Debugging
Enable HTTP request logging:
```bash
export HTTP_DEBUG=1
tolstoy auth
```

### JSON Validation
Test JSON syntax before using:
```bash
echo '{"test": "value"}' | jq .
```

## Performance Tips

### 1. Parallel Execution
Execute multiple actions in parallel:
```bash
#!/bin/bash
tolstoy actions:execute -o my-org -k action1 '{}' &
tolstoy actions:execute -o my-org -k action2 '{}' &
tolstoy actions:execute -o my-org -k action3 '{}' &
wait
```

### 2. Timeout Optimization
Set appropriate timeouts for different action types:
```bash
# Quick actions
tolstoy actions:execute --timeout 10 -o my-org -k quick-check '{}'

# Data processing
tolstoy actions:execute --timeout 300 -o my-org -k data-export '{}'
```

### 3. JSON Processing
Use `jq` for efficient JSON handling:
```bash
# Extract specific field
EXECUTION_ID=$(tolstoy actions:execute --json -o my-org -k action '{}' | jq -r '.executionId')

# Filter results
tolstoy actions:execute --json -o my-org -k list-items '{}' | jq '.data.items[] | select(.status == "active")'
```

## Version Information

Check CLI version and compatibility:
```bash
# Show version
tolstoy --version

# Show detailed build info
tolstoy --build-info
```

## Getting Help

### Command Help
```bash
# Main help
tolstoy --help

# Command-specific help
tolstoy actions:execute --help
tolstoy tool auth oauth2 --help
```

### Online Resources
- **Documentation**: [CLI Documentation](https://docs.tolstoy.com/cli)
- **GitHub Issues**: [Report Issues](https://github.com/tolstoy/cli/issues)
- **Community**: [Discord Community](https://discord.gg/tolstoy)